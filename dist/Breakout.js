/***
    Breakout - 0.2.2

    Copyright (c) 2011-2013 Jeff Hoefs <soundanalogous@gmail.com>
    Released under the MIT license. See LICENSE file for details.
    http://breakoutjs.com
    ***/
'use strict';var BO=BO||{},BREAKOUT=BREAKOUT||BO;BREAKOUT.VERSION="0.2.2";BO.enableDebugging=!1;var JSUTILS=JSUTILS||{};JSUTILS.namespace=function(a){var a=a.split("."),c=window,d;for(d=0;d<a.length;d+=1)"undefined"===typeof c[a[d]]&&(c[a[d]]={}),c=c[a[d]];return c};JSUTILS.inherit=function(a){function c(){}if(null===a)throw new TypeError;if(Object.create)return Object.create(a);var d=typeof a;if("object"!==d&&"function"!==d)throw new TypeError;c.prototype=a;return new c};
if(!Function.prototype.bind)Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var c=Array.prototype.slice.call(arguments,1),d=this,e=function(){},b=function(){return d.apply(this instanceof e?this:a||window,c.concat(Array.prototype.slice.call(arguments)))};e.prototype=this.prototype;b.prototype=new e;return b};JSUTILS.namespace("JSUTILS.Event");
JSUTILS.Event=function(){var a;a=function(a){this._type=a;this._target=null;this.name="Event"};a.prototype={constructor:a,get type(){return this._type},set type(a){this._type=a},get target(){return this._target},set target(a){this._target=a}};a.CONNECTED="connected";a.CHANGE="change";a.COMPLETE="complete";return a}();JSUTILS.namespace("JSUTILS.EventDispatcher");
JSUTILS.EventDispatcher=function(){var a;a=function(a){this._target=a||null;this._eventListeners={};this.name="EventDispatcher"};a.prototype={constructor:a,addEventListener:function(a,d){this._eventListeners[a]||(this._eventListeners[a]=[]);this._eventListeners[a].push(d)},removeEventListener:function(a,d){for(var e=0,b=this._eventListeners[a].length;e<b;e++)this._eventListeners[a][e]===d&&this._eventListeners[a].splice(e,1)},hasEventListener:function(a){return this._eventListeners[a]&&0<this._eventListeners[a].length?
!0:!1},dispatchEvent:function(a,d){a.target=this._target;var e=!1,b;for(b in d)d.hasOwnProperty(b)&&(a[b.toString()]=d[b]);if(this.hasEventListener(a.type)){b=0;for(var g=this._eventListeners[a.type].length;b<g;b++)try{this._eventListeners[a.type][b].call(this,a),e=!0}catch(f){console.log("error: Error calling event handler. "+f)}}return e}};return a}();JSUTILS.namespace("JSUTILS.TimerEvent");
JSUTILS.TimerEvent=function(){var a,c=JSUTILS.Event;a=function(a){this.name="TimerEvent";c.call(this,a)};a.TIMER="timerTick";a.TIMER_COMPLETE="timerComplete";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("JSUTILS.Timer");
JSUTILS.Timer=function(){var a,c=JSUTILS.TimerEvent,d=JSUTILS.EventDispatcher;a=function(a,b){d.call(this,this);this.name="Timer";this._count=0;this._delay=a;this._repeatCount=b||0;this._isRunning=!1;this._timer=null};a.prototype=JSUTILS.inherit(d.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("delay",function(){return this._delay});a.prototype.__defineSetter__("delay",function(a){this._delay=a;this._isRunning&&(this.stop(),this.start())});a.prototype.__defineGetter__("repeatCount",
function(){return this._repeatCount});a.prototype.__defineSetter__("repeatCount",function(a){this._repeatCount=a;this._isRunning&&(this.stop(),this.start())});a.prototype.__defineGetter__("running",function(){return this._isRunning});a.prototype.__defineGetter__("currentCount",function(){return this._count});a.prototype.start=function(){if(null===this._timer)this._timer=setInterval(this.onTick.bind(this),this._delay),this._isRunning=!0};a.prototype.reset=function(){this.stop();this._count=0};a.prototype.stop=
function(){if(null!==this._timer)clearInterval(this._timer),this._timer=null,this._isRunning=!1};a.prototype.onTick=function(){this._count+=1;0!==this._repeatCount&&this._count>this._repeatCount?(this.stop(),this.dispatchEvent(new c(c.TIMER_COMPLETE))):this.dispatchEvent(new c(c.TIMER))};return a}();JSUTILS.namespace("JSUTILS.SignalScope");
JSUTILS.SignalScope=function(){var a;a=function(a,d,e,b,g,f,h){this.name="SignalScope";this._canvas=document.getElementById(a);this._ctx=this._canvas.getContext("2d");this._width=d;this._height=e;this._rangeMin=b;this._rangeMax=g;this._ch1Color=f||"#FF0000";this._ch2Color=h||"#0000FF";this._markers=null;this._ch1Values=Array(d);this._ch2Values=Array(d);for(a=0;a<d;a++)this._ch1Values[a]=0,this._ch2Values[a]=0;this._range=100*(1/(g-b))};a.prototype.update=function(a,d){this._ctx.clearRect(0,0,this._width,
this._height);this._ch1Values.push(a);this._ch1Values.shift();this.drawChannel(this._ch1Values,this._ch1Color);void 0!==d&&(this._ch2Values.push(d),this._ch2Values.shift(),this.drawChannel(this._ch2Values,this._ch2Color));this.drawMarkers()};a.prototype.drawChannel=function(a,d){var e=0;this._ctx.strokeStyle=d;this._ctx.lineWidth=1;this._ctx.beginPath();this._ctx.moveTo(0,this._height);for(var b=0,g=a.length;b<g;b++)e=(this._rangeMax-a[b])*this._range,this._ctx.lineTo(b,e);this._ctx.stroke()};a.prototype.drawMarkers=
function(){var a=0;if(null!==this._markers)for(var d=0,e=this._markers.length;d<e;d++)a=(this._rangeMax-this._markers[d][0])*this._range,this._ctx.strokeStyle=this._markers[d][1],this._ctx.lineWidth=0.5,this._ctx.beginPath(),this._ctx.moveTo(0,a),this._ctx.lineTo(this._width,a),this._ctx.stroke()};a.prototype.addMarker=function(a,d){if(null===this._markers)this._markers=[];this._markers.push([a,d])};a.prototype.removeAllMarkers=function(){this._markers=null};return a}();JSUTILS.namespace("BO.IOBoardEvent");
BO.IOBoardEvent=function(){var a,c=JSUTILS.Event;a=function(a){this.name="IOBoardEvent";c.call(this,a)};a.ANALOG_DATA="analogData";a.DIGITAL_DATA="digitalData";a.FIRMWARE_VERSION="firmwareVersion";a.FIRMWARE_NAME="firmwareName";a.STRING_MESSAGE="stringMessage";a.SYSEX_MESSAGE="sysexMessage";a.PIN_STATE_RESPONSE="pinStateResponse";a.READY="ioBoardReady";a.CONNECTED="ioBoardConnected";a.DISCONNECTED="ioBoardDisonnected";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.WSocketEvent");
BO.WSocketEvent=function(){var a,c=JSUTILS.Event;a=function(a){this.name="WSocketEvent";c.call(this,a)};a.CONNECTED="webSocketConnected";a.MESSAGE="webSocketMessage";a.CLOSE="webSocketClosed";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.WSocketWrapper");
BO.WSocketWrapper=function(){var a,c=JSUTILS.EventDispatcher,d=BO.WSocketEvent;a=function(a,d,g){this.name="WSocketWrapper";c.call(this,this);this._host=a;this._port=d;this._protocol=g||"default-protocol";this._socket=null;this._readyState="";this.init(this)};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.init=function(a){if("undefined"!==typeof io){a._socket=io.connect("http://"+a._host+":"+a._port);try{a._socket.on("connect",function(){a._socket.socket.options.reconnect=
!1;a.dispatchEvent(new d(d.CONNECTED));a._socket.on("message",function(f){a.dispatchEvent(new d(d.MESSAGE),{message:f})})})}catch(b){console.log("Error "+b)}}else try{if("MozWebSocket"in window)a._socket=new MozWebSocket("ws://"+a._host+":"+a._port+"/websocket",a._protocol);else if("WebSocket"in window)a._socket=new WebSocket("ws://"+a._host+":"+a._port+"/websocket");else throw console.log("Websockets not supported by this browser"),"Websockets not supported by this browser";a._socket.onopen=function(){a.dispatchEvent(new d(d.CONNECTED));
a._socket.onmessage=function(f){a.dispatchEvent(new d(d.MESSAGE),{message:f.data})};a._socket.onclose=function(){a._readyState=a._socket.readyState;a.dispatchEvent(new d(d.CLOSE))}}}catch(g){console.log("Error "+g)}};a.prototype.send=function(a){this.sendString(a)};a.prototype.sendString=function(a){this._socket.send(a.toString())};a.prototype.__defineGetter__("readyState",function(){return this._readyState});return a}();JSUTILS.namespace("BO.filters.FilterBase");
BO.filters.FilterBase=function(){var a;a=function(){throw Error("Can't instantiate abstract classes");};a.prototype.processSample=function(){throw Error("Filter objects must implement the method processSample");};return a}();JSUTILS.namespace("BO.filters.Scaler");
BO.filters.Scaler=function(){var a,c=BO.filters.FilterBase;a=function(d,e,b,g,f,h){this.name="Scaler";this._inMin=d||0;this._inMax=e||1;this._outMin=b||0;this._outMax=g||1;this._type=f||a.LINEAR;this._limiter=h||!0};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.processSample=function(a){var e=this._outMax-this._outMin,a=(a-this._inMin)/(this._inMax-this._inMin);this._limiter&&(a=Math.max(0,Math.min(1,a)));return e*this._type(a)+this._outMin};a.LINEAR=function(a){return a};
a.SQUARE=function(a){return a*a};a.SQUARE_ROOT=function(a){return Math.pow(a,0.5)};a.CUBE=function(a){return a*a*a*a};a.CUBE_ROOT=function(a){return Math.pow(a,0.25)};return a}();JSUTILS.namespace("BO.filters.Convolution");
BO.filters.Convolution=function(){var a,c=BO.filters.FilterBase;a=function(a){this.name="Convolution";this._buffer=[];this.coef=a};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("coef",function(){return this._coef});a.prototype.__defineSetter__("coef",function(a){this._coef=a;this._buffer=Array(this._coef.length);for(var a=this._buffer.length,e=0;e<a;e++)this._buffer[e]=0});a.prototype.processSample=function(a){this._buffer.unshift(a);this._buffer.pop();
for(var a=0,e=this._buffer.length,b=0;b<e;b++)a+=this._coef[b]*this._buffer[b];return a};a.LPF=[1/3,1/3,1/3];a.HPF=[1/3,-2/3,1/3];a.MOVING_AVERAGE=[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125];return a}();JSUTILS.namespace("BO.filters.TriggerPoint");
BO.filters.TriggerPoint=function(){var a,c=BO.filters.FilterBase;a=function(a){this.name="TriggerPoint";this._points={};this._range=[];this._lastStatus=0;void 0===a&&(a=[[0.5,0]]);if(a[0]instanceof Array)for(var e=a.length,b=0;b<e;b++)this._points[a[b][0]]=a[b][1];else"number"===typeof a[0]&&(this._points[a[0]]=a[1]);this.updateRange();this._lastStatus=0};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.processSample=function(a){for(var e=this._lastStatus,b=this._range.length,
g=0;g<b;g++){var f=this._range[g];if(f[0]<=a&&a<=f[1]){e=g;break}}return this._lastStatus=e};a.prototype.addPoint=function(a,e){this._points[a]=e;this.updateRange()};a.prototype.removePoint=function(a){delete this._points[a];this.updateRange()};a.prototype.removeAllPoints=function(){this._points={};this.updateRange()};a.prototype.updateRange=function(){this._range=[];var a=this.getKeys(this._points),e=a[0];this._range.push([Number.NEGATIVE_INFINITY,e-this._points[e]]);for(var e=a.length-1,b=0;b<e;b++){var g=
a[b],f=a[b+1],g=1*g+this._points[g],f=f-this._points[f];if(g>=f)throw Error("The specified range overlaps...");this._range.push([g,f])}a=a[a.length-1];this._range.push([1*a+this._points[a],Number.POSITIVE_INFINITY])};a.prototype.getKeys=function(a){var e=[],b;for(b in a)a.hasOwnProperty(b)&&e.push(b);return e.sort()};return a}();JSUTILS.namespace("BO.generators.GeneratorEvent");
BO.generators.GeneratorEvent=function(){var a,c=JSUTILS.Event;a=function(a){c.call(this,a);this.name="GeneratorEvent"};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.UPDATE="update";return a}();JSUTILS.namespace("BO.generators.GeneratorBase");
BO.generators.GeneratorBase=function(){var a,c=JSUTILS.EventDispatcher;a=function(){c.call(this,this);this.name="GeneratorBase";this._value=void 0};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("value",function(){return this._value});a.prototype.__defineSetter__("value",function(a){this._value=a});return a}();JSUTILS.namespace("BO.generators.Oscillator");
BO.generators.Oscillator=function(){var a,c=BO.generators.GeneratorBase,d=BO.generators.GeneratorEvent,e=JSUTILS.Timer,b=JSUTILS.TimerEvent;a=function(b,f,h,d,l,m){c.call(this);this.name="Oscillator";this._wave=b||a.SIN;this._freq=f||1;this._amplitude=h||1;this._offset=d||0;this._phase=l||0;this._times=m||0;if(0===f)throw Error("Frequency should be larger than 0");this._lastVal=this._startTime=this._time=void 0;this._autoUpdateCallback=this.autoUpdate.bind(this);this._timer=new e(33);this._timer.start();
this.reset()};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineSetter__("serviceInterval",function(a){this._timer.delay=a});a.prototype.__defineGetter__("serviceInterval",function(){return this._timer.delay});a.prototype.start=function(){this.stop();this._timer.addEventListener(b.TIMER,this._autoUpdateCallback);this._startTime=(new Date).getTime();this.autoUpdate(null)};a.prototype.stop=function(){this._timer.hasEventListener(b.TIMER)&&this._timer.removeEventListener(b.TIMER,
this._autoUpdateCallback)};a.prototype.reset=function(){this._time=0;this._lastVal=0.999};a.prototype.update=function(a){a=a||-1;this._time=0>a?this._time+this._timer.delay:this._time+a;this.computeValue()};a.prototype.autoUpdate=function(){this._time=(new Date).getTime()-this._startTime;this.computeValue()};a.prototype.computeValue=function(){var b=this._time/1E3;0!==this._times&&this._freq*b>=this._times?(this.stop(),this._value=this._wave!==a.LINEAR?this._offset:this._amplitude*this._wave(1,0)+
this._offset):(b=this._freq*(b+this._phase),this._value=this._amplitude*this._wave(b,this._lastVal)+this._offset,this._lastVal=b);this.dispatchEvent(new d(d.UPDATE))};a.SIN=function(a){return 0.5*(1+Math.sin(2*Math.PI*(a-0.25)))};a.SQUARE=function(a){return 0.5>=a%1?1:0};a.TRIANGLE=function(a){a%=1;return 0.5>=a?2*a:2-2*a};a.SAW=function(a){a%=1;return 0.5>=a?a+0.5:a-0.5};a.IMPULSE=function(a,f){return a%1<f%1?1:0};a.LINEAR=function(a){return 1>a?a:1};return a}();JSUTILS.namespace("BO.PinEvent");
BO.PinEvent=function(){var a,c=JSUTILS.Event;a=function(a){this.name="PinEvent";c.call(this,a)};a.CHANGE="pinChange";a.RISING_EDGE="risingEdge";a.FALLING_EDGE="fallingEdge";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.Pin");
BO.Pin=function(){var a,c=JSUTILS.EventDispatcher,d=BO.PinEvent;a=function(a,b){this.name="Pin";this._type=b;this._capabilities={};this._number=a;this._analogNumber=void 0;this._maxPWMValue=255;this._value=0;this._lastValue=-1;this._average=this._preFilterValue=0;this._minimum=Math.pow(2,16);this._numSamples=this._sum=this._maximum=0;this._generator=this._filters=null;this._state=void 0;this._autoSetValueCallback=this.autoSetValue.bind(this);this._evtDispatcher=new c(this)};a.prototype={constructor:a,
setAnalogNumber:function(a){this._analogNumber=a},get analogNumber(){return this._analogNumber},get number(){return this._number},setMaxPWMValue:function(a){this._maxPWMValue=a},setState:function(d){this._type===a.PWM&&(d/=this.maxPWMValue);this._state=d},get maxPWMValue(){return this._maxPWMValue},get average(){return this._average},get minimum(){return this._minimum},get maximum(){return this._maximum},get state(){return this._state},get value(){return this._value},set value(a){this._lastValue=
this._value;this._preFilterValue=a;this._value=this.applyFilters(a);this.calculateMinMaxAndMean(this._value);this.detectChange(this._lastValue,this._value)},get lastValue(){return this._lastValue},get preFilterValue(){return this._preFilterValue},get filters(){return this._filters},set filters(a){this._filters=a},get generator(){return this._generator},getType:function(){return this._type},setType:function(d){if(0<=d&&d<a.TOTAL_PIN_MODES)this._type=d},getCapabilities:function(){return this._capabilities},
setCapabilities:function(a){this._capabilities=a},detectChange:function(a,b){a!==b&&(this.dispatchEvent(new d(d.CHANGE)),0>=a&&0!==b?this.dispatchEvent(new d(d.RISING_EDGE)):0!==a&&0>=b&&this.dispatchEvent(new d(d.FALLING_EDGE)))},clearWeight:function(){this._sum=this._average;this._numSamples=1},calculateMinMaxAndMean:function(a){var b=Number.MAX_VALUE;this._minimum=Math.min(a,this._minimum);this._maximum=Math.max(a,this._maximum);this._sum+=a;this._average=this._sum/++this._numSamples;this._numSamples>=
b&&this.clearWeight()},clear:function(){this._minimum=this._maximum=this._average=this._lastValue=this._preFilterValue;this.clearWeight()},addFilter:function(a){if(null!==a){if(null===this._filters)this._filters=[];this._filters.push(a)}},removeFilter:function(a){1>this._filters.length||(a=this._filters.indexOf(a),-1!==a&&this._filters.splice(a,1))},addGenerator:function(a){this.removeGenerator();this._generator=a;this._generator.addEventListener(BO.generators.GeneratorEvent.UPDATE,this._autoSetValueCallback)},
removeGenerator:function(){null!==this._generator&&this._generator.removeEventListener(BO.generators.GeneratorEvent.UPDATE,this._autoSetValueCallback);this._generator=null},removeAllFilters:function(){this._filters=null},autoSetValue:function(){this.value=this._generator.value},applyFilters:function(a){if(null===this._filters)return a;for(var b=this._filters.length,d=0;d<b;d++)a=this._filters[d].processSample(a);return a},addEventListener:function(a,b){this._evtDispatcher.addEventListener(a,b)},removeEventListener:function(a,
b){this._evtDispatcher.removeEventListener(a,b)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,b){return this._evtDispatcher.dispatchEvent(a,b)}};a.HIGH=1;a.LOW=0;a.ON=1;a.OFF=0;a.DIN=0;a.DOUT=1;a.AIN=2;a.AOUT=3;a.PWM=3;a.SERVO=4;a.SHIFT=5;a.I2C=6;a.TOTAL_PIN_MODES=7;return a}();JSUTILS.namespace("BO.I2CBase");
BO.I2CBase=function(){var a,c=BO.Pin,d=JSUTILS.EventDispatcher,e=BO.IOBoardEvent;a=function(b,g,f){if(void 0!==b){this.name="I2CBase";this.board=b;var h=f||0,f=h&255,h=h>>7&255;this._address=g;this._evtDispatcher=new d(this);g=b.getI2cPins();2===g.length?(b.getPin(g[0]).getType()!==c.I2C&&(b.getPin(g[0]).setType(c.I2C),b.getPin(g[1]).setType(c.I2C)),b.addEventListener(e.SYSEX_MESSAGE,this.onSysExMessage.bind(this)),b.sendSysex(a.I2C_CONFIG,[f,h])):console.log("Error, this board does not support i2c")}};
a.prototype={constructor:a,get address(){return this._address},onSysExMessage:function(b){var b=b.message,d=this.board.getValueFromTwo7bitBytes(b[1],b[2]),f=[];if(b[0]==a.I2C_REPLY&&d==this._address){for(var d=3,h=b.length;d<h;d+=2)f.push(this.board.getValueFromTwo7bitBytes(b[d],b[d+1]));this.handleI2C(f)}},sendI2CRequest:function(b){var d=[],f=b[0];d[0]=b[1];d[1]=f<<3;for(var f=2,h=b.length;f<h;f++)d.push(b[f]&127),d.push(b[f]>>7&127);this.board.sendSysex(a.I2C_REQUEST,d)},update:function(){},handleI2C:function(){},
addEventListener:function(a,d){this._evtDispatcher.addEventListener(a,d)},removeEventListener:function(a,d){this._evtDispatcher.removeEventListener(a,d)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,d){return this._evtDispatcher.dispatchEvent(a,d)}};a.I2C_REQUEST=118;a.I2C_REPLY=119;a.I2C_CONFIG=120;a.WRITE=0;a.READ=1;a.READ_CONTINUOUS=2;a.STOP_READING=3;return a}();JSUTILS.namespace("BO.PhysicalInputBase");
BO.PhysicalInputBase=function(){var a,c=JSUTILS.EventDispatcher;a=function(){this.name="PhysicalInputBase";this._evtDispatcher=new c(this)};a.prototype={constructor:a,addEventListener:function(a,c){this._evtDispatcher.addEventListener(a,c)},removeEventListener:function(a,c){this._evtDispatcher.removeEventListener(a,c)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,c){return this._evtDispatcher.dispatchEvent(a,c)}};return a}();JSUTILS.namespace("BO.io.Stepper");
BO.io.Stepper=function(){var a,c=0,d=BO.Pin,e=JSUTILS.EventDispatcher,b=JSUTILS.Event,g=BO.IOBoardEvent;a=function(f,b,i,l,m,k,j){this._id=c++;if(5<this._id)console.log("Warning: A maximum of 6 Stepper instances can be created");else switch(this.name="Stepper",this._board=f,this._evtDispatcher=new e(this),f=i&127,i=i>>7&127,this._board.setDigitalPinMode(l.number,d.DOUT),this._board.setDigitalPinMode(m.number,d.DOUT),this._board.addEventListener(g.SYSEX_MESSAGE,this.onSysExMessage.bind(this)),b){case a.DRIVER:case a.TWO_WIRE:this._board.sendSysex(114,
[0,this._id,b,f,i,l.number,m.number]);break;case a.FOUR_WIRE:this._board.setDigitalPinMode(k.number,d.DOUT),this._board.setDigitalPinMode(j.number,d.DOUT),this._board.sendSysex(114,[0,this._id,b,f,i,l.number,m.number,k.number,j.number])}};a.prototype={constructor:a,step:function(f,b,d,c){var e,g=a.CLOCKWISE;2097151<f&&(f=2097151,console.log("Warning: Maximum number of steps (2097151) exceeded. Setting to step number to 2097151"));-2097151>f&&(f=-2097151,console.log("Warning: Maximum number of steps (-2097151) exceeded. Setting to step number to -2097151"));
if(0<f)g=a.COUNTER_CLOCKWISE;f=[Math.abs(f)&127,Math.abs(f)>>7&127,Math.abs(f)>>14&127];b=Math.floor(100*b.toFixed(2));16383<b&&(b=16383,console.log("Warning: Maximum speed (163.83 rad/sec) exceeded. Setting speed to 163.83 rad/sec"));e=b&127;b=b>>7&127;void 0!==d&&void 0!==c?(d=Math.floor(100*d.toFixed(2)),c=Math.floor(100*c.toFixed(2)),this._board.sendSysex(114,[1,this._id,g,f[0],f[1],f[2],e,b,d&127,d>>7&127,c&127,c>>7&127])):this._board.sendSysex(114,[1,this._id,g,f[0],f[1],f[2],e,b])},onSysExMessage:function(a){a=
a.message;114===a[0]&&a[1]===this._id&&this.dispatchEvent(new b(b.COMPLETE))},get id(){return this._id},addEventListener:function(a,b){this._evtDispatcher.addEventListener(a,b)},removeEventListener:function(a,b){this._evtDispatcher.removeEventListener(a,b)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,b){return this._evtDispatcher.dispatchEvent(a,b)}};a.CLOCKWISE=0;a.COUNTER_CLOCKWISE=1;a.DRIVER=1;a.TWO_WIRE=2;a.FOUR_WIRE=4;return a}();JSUTILS.namespace("BO.io.BlinkM");
BO.io.BlinkM=function(){var a,c=BO.I2CBase;a=function(a,e){this.name="BlinkM";c.call(this,a,e||9)};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.goToRGBColorNow=function(a){this.sendI2CRequest([c.WRITE,this.address,110,a[0],a[1],a[2]])};a.prototype.fadeToRGBColor=function(a,e){var b=e||-1;0<=b&&this.sendI2CRequest([c.WRITE,this.address,102,b]);this.sendI2CRequest([c.WRITE,this.address,99,a[0],a[1],a[2]])};a.prototype.fadeToRandomRGBColor=function(a,e){var b=e||-1;
0<=b&&this.sendI2CRequest([c.WRITE,this.address,102,b]);this.sendI2CRequest([c.WRITE,this.address,67,a[0],a[1],a[2]])};a.prototype.fadeToHSBColor=function(a,e){var b=e||-1;0<=b&&this.sendI2CRequest([c.WRITE,this.address,102,b]);this.sendI2CRequest([c.WRITE,this.address,104,a[0],a[1],a[2]])};a.prototype.fadeToRandomHSBColor=function(a,e){var b=e||-1;0<=b&&this.sendI2CRequest([c.WRITE,this.address,102,b]);this.sendI2CRequest([c.WRITE,this.address,72,a[0],a[1],a[2]])};a.prototype.setFadeSpeed=function(a){this.sendI2CRequest([c.WRITE,
this.address,102,a])};a.prototype.playLightScript=function(a,e,b){this.sendI2CRequest([c.WRITE,this.address,112,a,e||1,b])};a.prototype.stopScript=function(){this.sendI2CRequest([c.WRITE,this.address,111])};a.prototype.handleI2C=function(a){console.log("BlinkM: "+a)};return a}();JSUTILS.namespace("BO.io.CompassEvent");
BO.io.CompassEvent=function(){var a,c=JSUTILS.Event;a=function(a){c.call(this,a);this.name="CompassEvent"};a.UPDATE="update";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.io.CompassHMC6352");
BO.io.CompassHMC6352=function(){var a,c=BO.I2CBase,d=BO.io.CompassEvent;a=function(a,b){this._lastHeading=this._heading=0;this.name="CompassHMC6352";c.call(this,a,b||33);this.sendI2CRequest([c.WRITE,this.address,71,116,81]);this.sendI2CRequest([c.WRITE,this.address,65]);this.startReading()};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("heading",function(){return this._heading});a.prototype.handleI2C=function(a){this._heading=Math.floor((a[1]<<8|a[2])/
10);this._heading!=this._lastHeading&&this.dispatchEvent(new d(d.UPDATE));this._lastHeading=this._heading};a.prototype.startReading=function(){this.sendI2CRequest([c.READ_CONTINUOUS,this.address,127,2])};a.prototype.stopReading=function(){this.sendI2CRequest([c.STOP_READING,this.address])};return a}();JSUTILS.namespace("BO.io.ButtonEvent");
BO.io.ButtonEvent=function(){var a,c=JSUTILS.Event;a=function(a){this.name="ButtonEvent";c.call(this,a)};a.PRESS="pressed";a.RELEASE="released";a.LONG_PRESS="longPress";a.SUSTAINED_PRESS="sustainedPress";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.io.Button");
BO.io.Button=function(){var a,c=BO.PhysicalInputBase,d=BO.PinEvent,e=BO.Pin,b=BO.io.ButtonEvent;a=function(b,f,h,i){c.call(this);this.name="Button";this._pin=f;f=f.number;this.buttonMode=h||a.PULL_DOWN;this._sustainedPressInterval=i||1E3;this._debounceInterval=20;this._repeatCount=0;this._timer=null;this._timeout=null;this._board=b;b.setDigitalPinMode(f,e.DIN);if(this.buttonMode===a.INTERNAL_PULL_UP)b.enablePullUp(f),this._pin.value=e.HIGH;else if(this.buttonMode===a.PULL_UP)this._pin.value=e.HIGH;
this._pin.addEventListener(d.CHANGE,this.onPinChange.bind(this))};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.onPinChange=function(b){var b=b.target.value,f;if(this.buttonMode===a.PULL_DOWN)f=1===b?this.pressed:this.released;else if(this.buttonMode===a.PULL_UP||this.buttonMode===a.INTERNAL_PULL_UP)f=1===b?this.released:this.pressed;null!==this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(f.bind(this),this._debounceInterval)};a.prototype.pressed=
function(){this._timeout=null;this.dispatchEvent(new b(b.PRESS));this._timer=setInterval(this.sustainedPress.bind(this),this._sustainedPressInterval)};a.prototype.released=function(){this._timeout=null;this.dispatchEvent(new b(b.RELEASE));if(null!==this._timer)clearInterval(this._timer),this._timer=null;this._repeatCount=0};a.prototype.sustainedPress=function(){0<this._repeatCount?this.dispatchEvent(new b(b.SUSTAINED_PRESS)):this.dispatchEvent(new b(b.LONG_PRESS));this._repeatCount++};a.prototype.__defineGetter__("debounceInterval",
function(){return this._debounceInterval});a.prototype.__defineSetter__("debounceInterval",function(a){this._debounceInterval=a});a.prototype.__defineGetter__("sustainedPressInterval",function(){return this._sustainedPressInterval});a.prototype.__defineSetter__("sustainedPressInterval",function(a){this._sustainedPressInterval=a});a.prototype.__defineGetter__("pinNumber",function(){return this._pin.number});a.PULL_DOWN=0;a.PULL_UP=1;a.INTERNAL_PULL_UP=2;return a}();JSUTILS.namespace("BO.io.PotEvent");
BO.io.PotEvent=function(){var a,c=JSUTILS.Event;a=function(a){this.name="PotEvent";c.call(this,a)};a.CHANGE="potChange";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.io.Potentiometer");
BO.io.Potentiometer=function(){var a,c=BO.PhysicalInputBase,d=BO.filters.Scaler,e=BO.filters.Convolution,b=BO.PinEvent,g=BO.io.PotEvent;a=function(a,d,i){c.call(this);this.name="Potentiometer";this._pin=d;i=i||!1;a.enableAnalogPin(this._pin.analogNumber);i&&this._pin.addFilter(new e(e.MOVING_AVERAGE));this._pin.addEventListener(b.CHANGE,this.onPinChange.bind(this))};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("value",function(){return this._pin.value});
a.prototype.__defineGetter__("average",function(){return this._pin.average});a.prototype.__defineGetter__("preFilterValue",function(){return this._pin.preFilterValue});a.prototype.__defineGetter__("minimum",function(){return this._pin.minimum});a.prototype.__defineGetter__("maximum",function(){return this._pin.maximum});a.prototype.clear=function(){this._pin.clear()};a.prototype.setRange=function(a,b){this._pin.addFilter(new d(a||0,b||1,0,1,d.LINEAR))};a.prototype.onPinChange=function(){this.dispatchEvent(new g(g.CHANGE))};
return a}();JSUTILS.namespace("BO.io.AccelerometerEvent");BO.io.AccelerometerEvent=function(){var a,c=JSUTILS.Event;a=function(a){c.call(this,a);this.name="AccelerometerEvent"};a.UPDATE="update";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.io.AnalogAccelerometer");
BO.io.AnalogAccelerometer=function(){var a,c=180/Math.PI,d=BO.PhysicalInputBase,e=BO.PinEvent,b=BO.io.AccelerometerEvent,g=BO.filters.Scaler,f=BO.filters.Convolution;a=function(a,f,b,c,g,j){d.call(this);this.name="AnalogAccelerometer";a.enableAnalogPin(f.analogNumber);a.enableAnalogPin(b.analogNumber);a.enableAnalogPin(c.analogNumber);this._enableSmoothing=j||!1;this._xPin=f||null;this._yPin=b||null;this._zPin=c||null;this._dynamicRange=g||1;this._z=this._y=this._x=0;null!==this._xPin&&this._xPin.addEventListener(e.CHANGE,
this.xAxisChanged.bind(this));null!==this._yPin&&this._yPin.addEventListener(e.CHANGE,this.yAxisChanged.bind(this));null!==this._zPin&&this._zPin.addEventListener(e.CHANGE,this.zAxisChanged.bind(this))};a.prototype=JSUTILS.inherit(d.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("dynamicRange",function(){return this._dynamicRange});a.prototype.__defineGetter__("x",function(){return this._x});a.prototype.__defineGetter__("y",function(){return this._y});a.prototype.__defineGetter__("z",
function(){return this._z});a.prototype.__defineGetter__("pitch",function(){return Math.atan2(this._x,Math.sqrt(this._y*this._y+this._z*this._z))*c});a.prototype.__defineGetter__("roll",function(){return Math.atan2(this._y,Math.sqrt(this._x*this._x+this._z*this._z))*c});a.prototype.__defineGetter__("xPin",function(){return this._xPin});a.prototype.__defineGetter__("yPin",function(){return this._yPin});a.prototype.__defineGetter__("zPin",function(){return this._zPin});a.prototype.setRangeFor=function(b,
d,c){var e=this._dynamicRange;if(b===a.X_AXIS){if(null!==this._xPin)this._xPin.filters=[new g(d,c,-e,e,g.LINEAR)],this._enableSmoothing&&this._xPin.addFilter(new f(f.MOVING_AVERAGE))}else if(b===a.Y_AXIS){if(null!==this._yPin)this._yPin.filters=[new g(d,c,-e,e,g.LINEAR)],this._enableSmoothing&&this._yPin.addFilter(new f(f.MOVING_AVERAGE))}else if(b===a.Z_AXIS&&null!==this._zPin)this._zPin.filters=[new g(d,c,-e,e,g.LINEAR)],this._enableSmoothing&&this._zPin.addFilter(new f(f.MOVING_AVERAGE))};a.prototype.getCalibratedRange=
function(a,f,b){var d={min:0,max:0},c=(f-a)/2,a=(a+f)/2;d.min=(a-c*this._dynamicRange)/b;d.max=(a+c*this._dynamicRange)/b;return d};a.prototype.xAxisChanged=function(a){this._x=a.target.value;this.dispatchEvent(new b(b.UPDATE))};a.prototype.yAxisChanged=function(a){this._y=a.target.value;this.dispatchEvent(new b(b.UPDATE))};a.prototype.zAxisChanged=function(a){this._z=a.target.value;this.dispatchEvent(new b(b.UPDATE))};a.X_AXIS=0;a.Y_AXIS=1;a.Z_AXIS=2;return a}();JSUTILS.namespace("BO.io.AccelerometerADXL345");
BO.io.AccelerometerADXL345=function(){var a,c=180/Math.PI,d=BO.I2CBase,e=BO.io.AccelerometerEvent;a=function(b,c,f){f=f||a.DEVICE_ID;d.call(this,b,f);this.name="AccelerometerADXL345";this._dynamicRange=c||a.RANGE_2G;this._sensitivity={x:a.DEFAULT_SENSITIVITY,y:a.DEFAULT_SENSITIVITY,z:a.DEFAULT_SENSITIVITY};this._offset={x:0,y:0,z:0};this._isReading=!1;this._debugMode=BO.enableDebugging;this._rawZ=this._rawY=this._rawX=this._z=this._y=this._x=0;this.powerOn();this.setRangeAndFullRes(this._dynamicRange)};
a.prototype=JSUTILS.inherit(d.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("dynamicRange",function(){return this._dynamicRange});a.prototype.__defineGetter__("x",function(){return this._x});a.prototype.__defineGetter__("y",function(){return this._y});a.prototype.__defineGetter__("z",function(){return this._z});a.prototype.__defineGetter__("pitch",function(){return Math.atan2(this._x,Math.sqrt(this._y*this._y+this._z*this._z))*c});a.prototype.__defineGetter__("roll",function(){return Math.atan2(this._y,
Math.sqrt(this._x*this._x+this._z*this._z))*c});a.prototype.__defineGetter__("rawX",function(){return this._rawX});a.prototype.__defineGetter__("rawY",function(){return this._rawY});a.prototype.__defineGetter__("rawZ",function(){return this._rawZ});a.prototype.__defineGetter__("isRunning",function(){return this._isReading});a.prototype.__defineGetter__("sensitivityX",function(){return this._sensitivity.x});a.prototype.__defineSetter__("sensitivityX",function(a){this._sensitivity.x=a});a.prototype.__defineGetter__("sensitivityY",
function(){return this._sensitivity.y});a.prototype.__defineSetter__("sensitivityY",function(a){this._sensitivity.y=a});a.prototype.__defineGetter__("sensitivityZ",function(){return this._sensitivity.z});a.prototype.__defineSetter__("sensitivityZ",function(a){this._sensitivity.z=a});a.prototype.setRangeAndFullRes=function(a){switch(a){case 2:a=0;break;case 4:a=1;break;case 8:a=2;break;case 16:a=3;break;default:a=0}this.sendI2CRequest([d.WRITE,this._address,49,a|8])};a.prototype.handleI2C=function(a){switch(a[0]){case 178:this.readAccel(a);
break;case 30:this.debug("offset x = "+a[2]);break;case 31:this.debug("offset y = "+a[2]);break;case 32:this.debug("offset z = "+a[2])}};a.prototype.startReading=function(){if(!this._isReading)this._isReading=!0,this.sendI2CRequest([d.READ_CONTINUOUS,this.address,178,6])};a.prototype.stopReading=function(){this._isReading=!1;this.sendI2CRequest([d.STOP_READING,this.address])};a.prototype.setAxisOffset=function(a,c,f){this._offset.x=a;this._offset.y=c;this._offset.z=f;this.sendI2CRequest([d.WRITE,
this.address,30,a]);this.sendI2CRequest([d.WRITE,this.address,31,c]);this.sendI2CRequest([d.WRITE,this.address,32,f])};a.prototype.getAxisOffset=function(){this.sendI2CRequest([d.READ,this.address,30,1]);this.sendI2CRequest([d.READ,this.address,31,1]);this.sendI2CRequest([d.READ,this.address,32,1]);return this._offset};a.prototype.update=function(){this._isReading&&this.stopReading();this.sendI2CRequest([d.READ,this.address,178,6])};a.prototype.powerOn=function(){this.sendI2CRequest([d.WRITE,this.address,
45,0]);this.setRegisterBit(45,3,!0)};a.prototype.setRegisterBit=function(a,c,f){var h;this.sendI2CRequest([d.WRITE,this.address,a,f?h|1<<c:h&~(1<<c)])};a.prototype.readAccel=function(a){var d,f;if(7!=a.length)throw Error("Incorrect number of bytes returned");d=a[2]<<8|a[1];f=a[4]<<8|a[3];a=a[6]<<8|a[5];this._rawX=d>>15?-1*((d^65535)+1):d;this._rawY=f>>15?-1*((f^65535)+1):f;this._rawZ=a>>15?-1*((a^65535)+1):a;this._x=this._rawX*this._sensitivity.x;this._y=this._rawY*this._sensitivity.y;this._z=this._rawZ*
this._sensitivity.z;this.dispatchEvent(new e(e.UPDATE))};a.prototype.debug=function(a){this._debugMode&&console.log(a)};a.RANGE_2G=2;a.RANGE_4G=4;a.RANGE_8G=8;a.RANGE_16G=16;a.DEVICE_ID=83;a.DEFAULT_SENSITIVITY=0.00390625;return a}();JSUTILS.namespace("BO.io.GyroEvent");BO.io.GyroEvent=function(){var a,c=JSUTILS.Event;a=function(a){c.call(this,a);this.name="GyroEvent"};a.GYRO_READY="gyroReady";a.UPDATE="update";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.io.GyroITG3200");
BO.io.GyroITG3200=function(){var a,c=BO.I2CBase,d=BO.io.GyroEvent;a=function(d,b,g){void 0===b&&(b=!0);g=g||a.ID_AD0_VDD;c.call(this,d,g);this.name="GyroITG3200";this._autoStart=b;this._isReading=!1;this._tempOffsets={};this._startupTimer=null;this._debugMode=BO.enableDebugging;this._z=this._y=this._x=0;this._gains={x:1,y:1,z:1};this._offsets={x:0,y:0,z:0};this._polarities={x:0,y:0,z:0};this.setRevPolarity(!1,!1,!1);this.init()};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("isRunning",
function(){return this._isReading});a.prototype.__defineGetter__("x",function(){return this._x/14.375*this._polarities.x*this._gains.x+this._offsets.x});a.prototype.__defineGetter__("y",function(){return this._y/14.375*this._polarities.y*this._gains.y+this._offsets.y});a.prototype.__defineGetter__("z",function(){return this._z/14.375*this._polarities.z*this._gains.z+this._offsets.z});a.prototype.__defineGetter__("rawX",function(){return this._rawX});a.prototype.__defineGetter__("rawY",function(){return this._rawY});
a.prototype.__defineGetter__("rawZ",function(){return this._rawZ});a.prototype.setRevPolarity=function(a,b,d){this._polarities.x=a?-1:1;this._polarities.y=b?-1:1;this._polarities.z=d?-1:1};a.prototype.setOffsets=function(a,b,d){this._offsets.x=a;this._offsets.y=b;this._offsets.z=d};a.prototype.setGains=function(a,b,d){this._gains.x=a;this._gains.y=b;this._gains.z=d};a.prototype.startReading=function(){if(!this._isReading)this._isReading=!0,this.sendI2CRequest([c.READ_CONTINUOUS,this.address,29,6])};
a.prototype.stopReading=function(){this._isReading=!1;this.sendI2CRequest([c.STOP_READING,this.address])};a.prototype.update=function(){this._isReading&&this.stopReading();this.sendI2CRequest([c.READ,this.address,29,6])};a.prototype.init=function(){this.sendI2CRequest([c.WRITE,this.address,21,0]);this.sendI2CRequest([c.WRITE,this.address,22,24]);this.sendI2CRequest([c.WRITE,this.address,62,0]);this.sendI2CRequest([c.WRITE,this.address,23,5]);this._startupTimer=setTimeout(this.onGyroReady.bind(this),
70)};a.prototype.onGyroReady=function(){this._startupTimer=null;this.dispatchEvent(new d(d.GYRO_READY));this._autoStart&&this.startReading()};a.prototype.setRegisterBit=function(a,b,d){var f;this.sendI2CRequest([c.WRITE,this.address,a,d?f|1<<b:f&~(1<<b)])};a.prototype.handleI2C=function(a){switch(a[0]){case 29:this.readGyro(a);break;default:this.debug("Got unexpected register data")}};a.prototype.readGyro=function(a){var b,c;if(7!=a.length)throw Error("Incorrecte number of bytes returned");b=a[1]<<
8|a[2];c=a[3]<<8|a[4];a=a[5]<<8|a[6];this._x=b>>15?-1*((b^65535)+1):b;this._y=c>>15?-1*((c^65535)+1):c;this._z=a>>15?-1*((a^65535)+1):a;this.dispatchEvent(new d(d.UPDATE))};a.prototype.debug=function(a){this._debugMode&&console.log(a)};a.ID_AD0_VDD=105;a.ID_AD0_GND=104;return a}();JSUTILS.namespace("BO.io.MagnetometerEvent");
BO.io.MagnetometerEvent=function(){var a,c=JSUTILS.Event;a=function(a){c.call(this,a);this.name="MagnetometerEvent"};a.UPDATE="update";a.prototype=JSUTILS.inherit(c.prototype);return a.prototype.constructor=a}();JSUTILS.namespace("BO.io.MagnetometerHMC5883");
BO.io.MagnetometerHMC5883=function(){var a,c=Math.PI/180,d=BO.I2CBase,e=BO.io.MagnetometerEvent;a=function(b,c,f,h){c=c||a.DEVICE_ID;f=f||a.SAMPLES_1;h=h||a.HZ_30;d.call(this,b,c);this._z=this._y=this._x=0;this._scale=0.92;this._isReading=!1;this._debugMode=BO.enableDebugging;this.name="MagnetometerHMC5883";this.sendI2CRequest([d.WRITE,this.address,0,f<<5|h<<2|0]);this.sendI2CRequest([d.WRITE,this.address,2,0]);this.startReading()};a.prototype=JSUTILS.inherit(d.prototype);a.prototype.constructor=
a;a.prototype.__defineGetter__("heading",function(){return this.getHeading(this._x,this._y)});a.prototype.__defineGetter__("x",function(){return this._x});a.prototype.__defineGetter__("y",function(){return this._y});a.prototype.__defineGetter__("z",function(){return this._z});a.prototype.handleI2C=function(a){var d,f;3===a[0]?(d=a[1]<<8|a[2],f=a[3]<<8|a[4],a=a[5]<<8|a[6],this._x=d>>15?-1*((d^65535)+1):d,this._y=a>>15?-1*((a^65535)+1):a,this._z=f>>15?-1*((f^65535)+1):f,this.dispatchEvent(new e(e.UPDATE))):
console.log("Warning: MagnetometerHMC5883 received data from unknown register")};a.prototype.getHeading=function(a,d){var f=0;0<d?f=90-180*Math.atan(a/d)/Math.PI:0>d?f=270-180*Math.atan(a/d)/Math.PI:0===d&&0>a?f=180:0===d&&0<a&&(f=0);return f};a.prototype.getTiltCompensatedHeading=function(a,d){var a=a*c,d=d*c,f=this._x*Math.cos(a)+this._y*Math.sin(d)*Math.sin(a)-this._z*Math.cos(d)*Math.sin(a),h=this._y*Math.cos(d)+this._z*Math.sin(d);return this.getHeading(f,h)};a.prototype.startReading=function(){if(!this._isReading)this._isReading=
!0,this.sendI2CRequest([d.READ_CONTINUOUS,this.address,3,6])};a.prototype.stopReading=function(){this._isReading=!1;this.sendI2CRequest([d.STOP_READING,this.address])};a.prototype.update=function(){this._isReading&&this.stopReading();this.sendI2CRequest([d.READ,this.address,3,6])};a.prototype.debug=function(a){this._debugMode&&console.log(a)};a.DEVICE_ID=30;a.SAMPLES_1=0;a.SAMPLES_2=1;a.SAMPLES_4=2;a.SAMPLES_8=3;a.HZ_0_75=0;a.HZ_1_5=1;a.HZ_3=2;a.HZ_7_5=3;a.HZ_15=4;a.HZ_30=5;a.HZ_75=6;return a}();
JSUTILS.namespace("BO.io.Servo");
BO.io.Servo=function(){var a,c=BO.Pin;a=function(a,c,b,g){this.name="Servo";this._pin=c;this._angle=void 0;this._minAngle=b||0;this._maxAngle=g||180;a.sendServoAttach(c.number)};a.prototype={constructor:a,set angle(d){if(this._pin.getType()===c.SERVO)this._angle=d,this._pin.value=Math.max(0,Math.min(1,(this._angle-this._minAngle)/(this._maxAngle-this._minAngle)*a.COEF_TO_0_180))},get angle(){if(this._pin.getType()===c.SERVO)return this._angle}};a.COEF_TO_0_180=180/255;return a}();JSUTILS.namespace("BO.io.DCMotor");
BO.io.DCMotor=function(){var a,c=BO.Pin;a=function(a,e,b,g,f,h,i){this.name="DCMotor";f=f||1;h=h||9;i=i||9;void 0===g&&(g=null);this._range=this._offset=this._value=0;this._forwardPin=e;this._reversePin=b;this._pwmPin=g;null!==this._pwmPin&&(this._pwmPin.getCapabilities()[c.PWM]?a.setDigitalPinMode(this._pwmPin.number,c.PWM):(console.log("warning: PWM is not available for the PWM pin"),a.setDigitalPinMode(this._pwmPin.number,c.DOUT)));this._forwardPin.getCapabilities()[c.PWM]?a.setDigitalPinMode(this._forwardPin.number,
c.PWM):(console.log("warning: PWM is not available for the forward pin"),a.setDigitalPinMode(this._forwardPin.number,c.DOUT));this._reversePin.getCapabilities()[c.PWM]?a.setDigitalPinMode(this._reversePin.number,c.PWM):(console.log("warning: PWM is not available for the reverse pin"),a.setDigitalPinMode(this._reversePin.number,c.DOUT));this._offset=f/i;this._range=(h-f)/i;this.despin(!1)};a.prototype={constructor:a,set value(a){this._value=Math.max(-1,Math.min(1,a));0<a?this.forward(this._value):
0>a?this.reverse(-this._value):this.despin()},get value(){return this._value},despin:function(a){void 0===a&&(a=!0);a?null===this._pwmPin?(this._forwardPin.value=1,this._reversePin.value=1):(this._forwardPin.value=1,this._reversePin.value=1,this._pwmPin.value=1):null===this._pwmPin?(this._forwardPin.value=0,this._reversePin.value=0):(this._forwardPin.value=0,this._reversePin.value=0,this._pwmPin.value=0);this._value=0},forward:function(a){this._value=Math.max(0,Math.min(1,a||1));null===this._pwmPin?
(this._forwardPin.value=Math.max(0,Math.min(1,this._value*this._range+this._offset)),this._reversePin.value=0):(this._forwardPin.value=1,this._reversePin.value=0,this._pwmPin.value=Math.max(0,Math.min(1,this._value*this._range+this._offset)))},reverse:function(a){this._value=-1*Math.max(0,Math.min(1,a||1));null===this._pwmPin?(this._forwardPin.value=0,this._reversePin.value=Math.max(0,Math.min(1,-1*this._value*this._range+this._offset))):(this._forwardPin.value=0,this._reversePin.value=1,this._pwmPin.value=
Math.max(0,Math.min(1,-1*this._value*this._range+this._offset)))}};return a}();JSUTILS.namespace("BO.io.LED");
BO.io.LED=function(){var a,c=BO.Pin,d=BO.generators.Oscillator;a=function(d,b,g){this.name="LED";this._driveMode=g||a.SOURCE_DRIVE;this._pin=b;this._onValue=1;this._offValue=0;this._supportsPWM=void 0;if(this._driveMode===a.SOURCE_DRIVE)this._onValue=1,this._offValue=0;else if(this._driveMode===a.SYNC_DRIVE)this._onValue=0,this._offValue=1;else throw"driveMode should be LED.SOURCE_DRIVE or LED.SYNC_DRIVE";this._pin.getCapabilities()[c.PWM]?(d.setDigitalPinMode(this._pin.number,c.PWM),this._supportsPWM=
!0):(d.setDigitalPinMode(this._pin.number,c.DOUT),this._supportsPWM=!1);this.off()};a.prototype={constructor:a,get intensity(){return this._pin.value},set intensity(d){this._supportsPWM||(d=0.5>d?0:1);if(this._driveMode===a.SOURCE_DRIVE)this._pin.value=d;else if(this._driveMode===a.SYNC_DRIVE)this._pin.value=1-d},on:function(){this._pin.value=this._onValue},off:function(){this._pin.value=this._offValue},isOn:function(){return this._pin.value===this._onValue},toggle:function(){this._pin.value=1-this._pin.value},
blink:function(a,b,c){a=1E3/a;b=b||0;c=c||d.SQUARE;if(!this._supportsPWM&&c!==d.SQUARE)console.log("warning: Only Oscillator.SQUARE may be used on a non-PWM pin."),console.log("debug: Setting wave to Oscillator.SQUARE."),c=d.SQUARE;this._pin.addGenerator(new d(c,a,1,0,0,b));this._pin.generator.start()},stopBlinking:function(){null!==this._pin.generator&&this._pin.generator.stop();this.off()},fadeIn:function(a){this.fadeTo(this._onValue,a)},fadeOut:function(a){this.fadeTo(this._offValue,a)},fadeTo:function(c,
b){if(this._supportsPWM){this._driveMode===a.SYNC_DRIVE&&(c=1-c);var g=1E3/(b||1E3);this._pin.value!==c?(this._pin.addGenerator(new d(d.LINEAR,g,c-this._pin.value,this._pin.value,0,1)),this._pin.generator.start()):this._pin.removeGenerator()}else console.log("warning: Fade methods can only be used for LEDs connected to PWM pins.")}};a.SOURCE_DRIVE=0;a.SYNC_DRIVE=1;return a}();JSUTILS.namespace("BO.io.RGBLED");
BO.io.RGBLED=function(){var a,c=BO.io.LED;a=function(d,e,b,g,f){this.name="RGBLED";if(void 0===f)f=a.COMMON_ANODE;this._redLED=new c(d,e,f);this._greenLED=new c(d,b,f);this._blueLED=new c(d,g,f)};a.prototype={constructor:a,setColor:function(a,c,b){this._redLED.intensity=a/255;this._greenLED.intensity=c/255;this._blueLED.intensity=b/255},fadeIn:function(a){a=a||1E3;this._redLED.fadeTo(1,a);this._greenLED.fadeTo(1,a);this._blueLED.fadeTo(1,a)},fadeOut:function(a){a=a||1E3;this._redLED.fadeTo(0,a);this._greenLED.fadeTo(0,
a);this._blueLED.fadeTo(0,a)},fadeTo:function(a,c,b,g){c/=255;b/=255;g=g||1E3;this._redLED.fadeTo(a/255,g);this._greenLED.fadeTo(c,g);this._blueLED.fadeTo(b,g)}};a.COMMON_ANODE=c.SYNC_DRIVE;a.COMMON_CATHODE=c.SOURCE_DRIVE;return a}();JSUTILS.namespace("BO.io.SoftPotEvent");
BO.io.SoftPotEvent=function(){var a,c=JSUTILS.Event;a=function(a,e){this.name="SoftPotEvent";c.call(this,a);this._touchPoint=e};a.PRESS="softPotPressed";a.RELEASE="softPotRelease";a.DRAG="softPotDrag";a.FLICK_UP="softPotFlickUp";a.FLICK_DOWN="softPotFlickDown";a.TAP="softPotTap";a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("value",function(){return this._touchPoint});a.prototype.__defineSetter__("value",function(a){this._touchPoint=a});return a}();
JSUTILS.namespace("BO.io.SoftPot");
BO.io.SoftPot=function(){var a,c=BO.PhysicalInputBase,d=BO.PinEvent,e=BO.filters.Scaler,b=JSUTILS.Timer,g=BO.io.SoftPotEvent;a=function(a,h,i){c.call(this);this.name="SoftPot";this._pin=h;i=i||100;this._isDrag=!1;this._lastMovePoint=this._touchPoint=this._flickDistance=0;this._isTouched=!1;this._distanceFromPressed=0;this._minFlickMovement=2.5*(1/i);this._minDragMovement=1*(1/i);this._tapTimeout=200;this._minValue=0.01;this._board=a;a.enableAnalogPin(this._pin.analogNumber);this._debugMode=BO.enableDebugging;
this._pin.addEventListener(d.CHANGE,this.onPinChange.bind(this));this._pressTimer=new b(10,0);this._flickTimer=new b(200,1)};a.prototype=JSUTILS.inherit(c.prototype);a.prototype.constructor=a;a.prototype.onPinChange=function(a){a=a.target.value;if(this._isTouched&&a<this._minValue)this.onRelease();else if(a>=this._minValue)if(this._isTouched)this.onMove(a);else this.startTouch(a),this._lastMovePoint=a};a.prototype.setMinFlickMovement=function(a){this._minFlickMovement=a};a.prototype.startTouch=function(a){this._pressTimer.reset();
this._pressTimer.start();this._touchPoint=a;this.dispatch(g.PRESS);this._isTouched=!0;this._isDrag=!1};a.prototype.onRelease=function(){var a=!1;2<this._pressTimer.currentCount&&(this._flickTimer.running&&(0<this._flickDir?this.dispatch(g.FLICK_DOWN):this.dispatch(g.FLICK_UP),a=!0),a||this._pressTimer.running&&!this._isDrag&&this._pressTimer.currentCount<=this._tapTimeout/10&&this.dispatch(g.TAP));this.dispatch(g.RELEASE);this.resetForNext()};a.prototype.onMove=function(a){this._touchPoint=a;this._flickDistance=
Math.abs(a-this._lastMovePoint);if(!this._isDrag&&this._flickDistance>this._minFlickMovement)this._flickTimer.reset(),this._flickTimer.start(),this._flickDir=0<a-this._lastMovePoint?1:-1,this._isDrag=!1;var b=Math.abs(a-this._lastMovePoint);if(b>this._minDragMovement&&!1===this._flickTimer.running)this._isDrag=!0;if(this._isDrag)this.dispatch(g.DRAG),this._distanceFromPressed=a-this._lastMovePoint;this.debug("SoftPot: distance traveled flick is "+this._flickDistance);this.debug("SoftPot: distance traveled drag is "+
b);this._lastMovePoint=a};a.prototype.setRange=function(a,b){this._pin.removeAllFilters();this._pin.addFilter(new e(a,b,0,1,e.LINEAR))};a.prototype.dispatch=function(a){this.debug("SoftPot dispatch "+a);this.dispatchEvent(new g(a,this._touchPoint))};a.prototype.resetForNext=function(){this._flickTimer.stop();this._pressTimer.stop();this._isDrag=this._isTouched=!1};a.prototype.debug=function(a){this._debugMode&&console.log(a)};a.prototype.__defineGetter__("value",function(){return this._touchPoint});
a.prototype.__defineGetter__("distanceFromPressed",function(){return this._distanceFromPressed});a.prototype.__defineGetter__("minFlickMovement",function(){return this._minFlickMovement});a.prototype.__defineSetter__("minFlickMovement",function(a){this._minFlickMovement=a});a.prototype.__defineGetter__("minDragMovement",function(){return this._minDragMovement});a.prototype.__defineSetter__("minDragMovement",function(a){this._minDragMovement=a});a.prototype.__defineGetter__("tapTimeout",function(){return this._tapTimeout});
a.prototype.__defineSetter__("tapTimeout",function(a){this._tapTimeout=a});a.prototype.__defineGetter__("minValue",function(){return this._minValue});a.prototype.__defineSetter__("minValue",function(a){this._minValue=a});return a}();JSUTILS.namespace("BO.IOBoard");
BO.IOBoard=function(){var a,c=BO.Pin,d=JSUTILS.EventDispatcher,e=BO.PinEvent,b=BO.IOBoardEvent,g={previous:0,shift:0,binaryData:[],startBinaryWrite:function(){this.shift=0;this.binaryData=[]},endBinaryWrite:function(){0<this.shift&&this.binaryData.push(this.previous)},writeBinary:function(a){a&=255;0===this.shift?(this.binaryData.push(a&127),this.shift++,this.previous=a>>7):(this.binaryData.push(a<<this.shift&127|this.previous),6===this.shift?(this.binaryData(a>>1),this.shift=0):(this.shift++,this.previous=
a>>8-this.shift))},readBinary:function(a,b){for(var c,d,e=[],g=0;g<a;g++)c=g<<3,d=c/7,c=c%7&255,e[g]=b[d]>>c|b[d+1]<<7-c&255;return e},num7BitOutbytes:function(a){return 7*a>>3}};a=function(a,b,c){this.name="IOBoard";this._socket=null;this._inputDataBuffer=[];this._digitalPort=[];this._numPorts=0;this._analogPinMapping=[];this._digitalPinMapping=[];this._i2cPins=[];this._ioPins=[];this._totalAnalogPins=this._totalPins=0;this._samplingInterval=19;this._isReady=!1;this._firmwareName="";this._firmwareVersion=
0;this._evtDispatcher=null;this._capabilityQueryResponseReceived=this._isConfigured=this._isMultiClientEnabled=!1;this._debugMode=BO.enableDebugging;this._numPinStateRequests=0;this._evtDispatcher=new d(this);this.initialVersionResultHandler=this.onInitialVersionResult.bind(this);this.sendOutHandler=this.sendOut.bind(this);this.socketConnectionHandler=this.onSocketConnection.bind(this);this.socketMessageHandler=this.onSocketMessage.bind(this);this.socketClosedHandler=this.onSocketClosed.bind(this);
this._socket=new BO.WSocketWrapper(a,b,c);this._socket.addEventListener(BO.WSocketEvent.CONNECTED,this.socketConnectionHandler);this._socket.addEventListener(BO.WSocketEvent.MESSAGE,this.socketMessageHandler);this._socket.addEventListener(BO.WSocketEvent.CLOSE,this.socketClosedHandler)};a.prototype={constructor:a,onSocketConnection:function(){this.debug("debug: Socket Status: (open)");this.dispatchEvent(new b(b.CONNECTED));this.begin()},onSocketMessage:function(a){var b=a.message,a=[];if(1<b.length)for(var a=
b.split(","),b=a.length,c=0;c<b;c++)this.parseInputMessage(a[c]);else this.parseInputMessage(b)},parseInputMessage:function(a){var b="";a.match(/config/)?(b=a.substr(a.indexOf(":")+2),this.processStatusMessage(b)):this.processInput(parseInt(a,10))},onSocketClosed:function(){this.debug("debug: Socket Status: "+this._socket.readyState+" (Closed)");this.dispatchEvent(new b(b.DISCONNECTED))},begin:function(){this.addEventListener(b.FIRMWARE_NAME,this.initialVersionResultHandler);this.reportFirmware()},
onInitialVersionResult:function(a){var c=10*a.version,d=a.name,e=this;this.removeEventListener(b.FIRMWARE_NAME,this.initialVersionResultHandler);this.debug("debug: Firmware name = "+d+", Firmware version = "+a.version);23<=c?this._isMultiClientEnabled?(this.queryCapabilities(),this.checkForQueryResponse()):(this.systemReset(),setTimeout(function(){e.queryCapabilities();e.checkForQueryResponse()},500)):console.log("error: You must upload StandardFirmata version 2.3 or greater from Arduino version 1.0 or higher")},
checkForQueryResponse:function(){var a=this;setTimeout(function(){!1===a._capabilityQueryResponseReceived&&a.startup()},200)},processStatusMessage:function(a){if("multiClient"===a)this.debug("debug: Multi-client mode enabled"),this._isMultiClientEnabled=!0},processInput:function(a){var b;this._inputDataBuffer.push(a);b=this._inputDataBuffer.length;if(128<=this._inputDataBuffer[0]&&240!=this._inputDataBuffer[0]){if(3===b)this.processMultiByteCommand(this._inputDataBuffer),this._inputDataBuffer=[]}else if(240===
this._inputDataBuffer[0]&&247===this._inputDataBuffer[b-1])this.processSysexCommand(this._inputDataBuffer),this._inputDataBuffer=[];else if(128<=a&&128>this._inputDataBuffer[0])console.log("warning: Malformed input data... resetting buffer"),this._inputDataBuffer=[],247!==a&&this._inputDataBuffer.push(a)},processMultiByteCommand:function(a){var c=a[0],d;240>c&&(c&=240,d=a[0]&15);switch(c){case 144:this.processDigitalMessage(d,a[1],a[2]);break;case 249:this._firmwareVersion=a[1]+a[2]/10;this.dispatchEvent(new b(b.FIRMWARE_VERSION),
{version:this._firmwareVersion});break;case 224:this.processAnalogMessage(d,a[1],a[2])}},processDigitalMessage:function(a,d,i){var e=8*a,a=e+8,d=d|i<<7,i={};if(a>=this._totalPins)a=this._totalPins;for(var g=0,k=e;k<a;k++){i=this.getDigitalPin(k);if(void 0===i)break;if(i.getType()==c.DIN&&(e=d>>g&1,e!=i.value))i.value=e,this.dispatchEvent(new b(b.DIGITAL_DATA),{pin:i});g++}},processAnalogMessage:function(a,c,d){a=this.getAnalogPin(a);if(void 0!==a)a.value=this.getValueFromTwo7bitBytes(c,d)/1023,a.value!=
a.lastValue&&this.dispatchEvent(new b(b.ANALOG_DATA),{pin:a})},processSysexCommand:function(a){a.shift();a.pop();switch(a[0]){case 121:this.processQueryFirmwareResult(a);break;case 113:this.processSysExString(a);break;case 108:this.processCapabilitiesResponse(a);break;case 110:this.processPinStateResponse(a);break;case 106:this.processAnalogMappingResponse(a);break;case 117:this.processShiftData(a);break;default:this.dispatchEvent(new b(b.SYSEX_MESSAGE),{message:a})}},processQueryFirmwareResult:function(a){for(var c,
d=3,e=a.length;d<e;d+=2)c=a[d],c+=a[d+1],this._firmwareName+=String.fromCharCode(c);this._firmwareVersion=a[1]+a[2]/10;this.dispatchEvent(new b(b.FIRMWARE_NAME),{name:this._firmwareName,version:this._firmwareVersion})},processSysExString:function(a){for(var c="",d,e=a.length,g=1;g<e;g+=2)d=a[g],d+=a[g+1],c+=String.fromCharCode(d);this.dispatchEvent(new b(b.STRING_MESSAGE),{message:c})},processShiftData:function(a){var b=a.length,a=a.slice(3),b=g.num7BitOutbytes(b-3),b=g.readBinary(b,a);console.log(b)},
processCapabilitiesResponse:function(a){if(!this._isConfigured){var b={},d=1,e=0,g=0,k=a.length,j;for(this._capabilityQueryResponseReceived=!0;d<=k;)if(127==a[d]){this._digitalPinMapping[e]=e;j=void 0;if(b[c.DOUT])j=c.DOUT;if(b[c.AIN])j=c.AIN,this._analogPinMapping[g++]=e;j=new c(e,j);j.setCapabilities(b);this.managePinListener(j);this._ioPins[e]=j;j.getCapabilities()[c.I2C]&&this._i2cPins.push(j.number);b={};e++;d++}else b[a[d]]=a[d+1],d+=2;this._numPorts=Math.ceil(e/8);this.debug("debug: Num ports = "+
this._numPorts);for(a=0;a<this._numPorts;a++)this._digitalPort[a]=0;this._totalPins=e;this._totalAnalogPins=g;this.debug("debug: Num pins = "+this._totalPins);this.queryAnalogMapping()}},processAnalogMappingResponse:function(a){if(!this._isConfigured){for(var b=a.length,c=1;c<b;c++)127!=a[c]&&(this._analogPinMapping[a[c]]=c-1,this.getPin(c-1).setAnalogNumber(a[c]));this._isMultiClientEnabled?this.startupInMultiClientMode():this.startup()}},startupInMultiClientMode:function(){for(var a=this.getPinCount(),
b=0;b<a;b++)this.queryPinState(this.getDigitalPin(b));setTimeout(this.startup.bind(this),500);this._isConfigured=!0},startup:function(){this.debug("debug: IOBoard ready");this._isReady=!0;this.enableDigitalPins();this.dispatchEvent(new b(b.READY))},systemReset:function(){this.debug("debug: System reset");this.send(255)},processPinStateResponse:function(a){if(!(0>=this._numPinStateRequests)){var c=a.length,d=a[2],e,g=this._ioPins[a[1]];4<c?e=this.getValueFromTwo7bitBytes(a[3],a[4]):3<c&&(e=a[3]);g.getType()!=
d&&(g.setType(d),this.managePinListener(g));g.setState(e);this._numPinStateRequests--;if(0>this._numPinStateRequests)this._numPinStateRequests=0;this.dispatchEvent(new b(b.PIN_STATE_RESPONSE),{pin:g})}},toDec:function(a){a=a.substring(0,1);return a.charCodeAt(0)},sendOut:function(a){var b=a.target.getType(),d=a.target.number,a=a.target.value;switch(b){case c.DOUT:this.sendDigitalData(d,a);break;case c.AOUT:this.sendAnalogData(d,a);break;case c.SERVO:this.sendServoData(d,a)}},managePinListener:function(a){if(a.getType()==
c.DOUT||a.getType()==c.AOUT||a.getType()==c.SERVO)a.hasEventListener(e.CHANGE)||a.addEventListener(e.CHANGE,this.sendOutHandler);else if(a.hasEventListener(e.CHANGE))try{a.removeEventListener(e.CHANGE,this.sendOutHandler)}catch(b){this.debug("debug: Caught pin removeEventListener exception")}},sendAnalogData:function(a,b){var c=this.getDigitalPin(a).maxPWMValue,b=b*c,b=0>b?0:b,b=b>c?c:b;15<a||b>Math.pow(2,14)?this.sendExtendedAnalogData(a,b):this.send([224|a&15,b&127,b>>7&127])},sendExtendedAnalogData:function(a,
b){var c=[];if(b>Math.pow(2,16))throw console.log("error: Extended Analog values > 16 bits are not currently supported by StandardFirmata"),"error: Extended Analog values > 16 bits are not currently supported by StandardFirmata";c[0]=240;c[1]=111;c[2]=a;c[3]=b&127;c[4]=b>>7&127;b>=Math.pow(2,14)&&(c[5]=b>>14&127);c.push(247);this.send(c)},sendDigitalData:function(a,b){var d=Math.floor(a/8);if(b==c.HIGH)this._digitalPort[d]|=b<<a%8;else if(b==c.LOW)this._digitalPort[d]&=~(1<<a%8);else{console.log("warning: Invalid value passed to sendDigital, value must be 0 or 1.");
return}this.sendDigitalPort(d,this._digitalPort[d])},sendServoData:function(a,b){var d=this.getDigitalPin(a);d.getType()==c.SERVO&&d.lastValue!=b&&this.sendAnalogData(a,b)},queryCapabilities:function(){this.send([240,107,247])},queryAnalogMapping:function(){this.send([240,105,247])},setAnalogPinReporting:function(a,b){this.send([192|a,b]);this.getAnalogPin(a).setType(c.AIN)},debug:function(a){this._debugMode&&console.log(a)},get samplingInterval(){return this._samplingInterval},set samplingInterval(a){10<=
a&&100>=a?(this._samplingInterval=a,this.send([240,122,a&127,a>>7&127,247])):console.log("warning: Sampling interval must be between 10 and 100")},get isReady(){return this._isReady},getValueFromTwo7bitBytes:function(a,b){return b<<7|a},getSocket:function(){return this._socket},reportVersion:function(){this.send(249)},reportFirmware:function(){this.send([240,121,247])},disableDigitalPins:function(){for(var a=0;a<this._numPorts;a++)this.sendDigitalPortReporting(a,c.OFF)},enableDigitalPins:function(){for(var a=
0;a<this._numPorts;a++)this.sendDigitalPortReporting(a,c.ON)},sendDigitalPortReporting:function(a,b){this.send([208|a,b])},enableAnalogPin:function(a){this.setAnalogPinReporting(a,c.ON)},disableAnalogPin:function(a){this.setAnalogPinReporting(a,c.OFF)},setDigitalPinMode:function(a,b){this.getDigitalPin(a).setType(b);this.managePinListener(this.getDigitalPin(a));this.send([244,a,b])},enablePullUp:function(a){this.sendDigitalData(a,c.HIGH)},getFirmwareName:function(){return this._firmwareName},getFirmwareVersion:function(){return this._firmwareVersion},
getPinCapabilities:function(){var a=[],b,c,d,e,g={"0":"input",1:"output",2:"analog",3:"pwm",4:"servo",5:"shift",6:"i2c"};b=this._ioPins.length;for(var j=0;j<b;j++){c={};d=this._ioPins[j].getCapabilities();e=!1;for(var n in d)d.hasOwnProperty(n)&&(e=!0,0<=n&&(c[g[n]]=this._ioPins[j].getCapabilities()[n]));a[j]=e?c:{"not available":"0"}}return a},queryPinState:function(a){this.send([240,109,a.number,247]);this._numPinStateRequests++},sendDigitalPort:function(a,b){this.send([144|a&15,b&127,b>>7])},sendString:function(a){for(var b=
[],c=0,d=a.length;c<d;c++)b.push(this.toDec(a[c])&127),b.push(this.toDec(a[c])>>7&127);this.sendSysex(113,b)},sendSysex:function(a,b){var c=[240];c[1]=a;for(var d=0,e=b.length;d<e;d++)c.push(b[d]);c.push(247);this.send(c)},sendServoAttach:function(a,b,d){var e=[],b=b||544,d=d||2400;e[0]=240;e[1]=112;e[2]=a;e[3]=b%128;e[4]=b>>7;e[5]=d%128;e[6]=d>>7;e[7]=247;this.send(e);a=this.getDigitalPin(a);a.setType(c.SERVO);this.managePinListener(a)},getNumBytesInValue:function(a){var b=0;do a>>=8,b++;while(a);
return b},encodeMultiByteValue:function(a){var b=0;g.startBinaryWrite();b=this.getNumBytesInValue(a);for(b-=1;0<=b;b--)g.writeBinary(a>>8*b);g.endBinaryWrite()},sendShiftOut:function(a,b,c,d,e){var k=[240,117,1];k[3]=a.number;k[4]=b.number;k[5]=c.number;k[6]=d;this.encodeMultiByteValue(e);a=g.binaryData.length;for(b=0;b<a;b++)k.push(g.binaryData[b]);k.push(247);this.send(k)},sendShiftIn:function(a,b,c,d,e){var g=[240,117,2];g[3]=a.number;g[4]=b.number;g[5]=c.number;g[6]=d||1;g[7]=e||1;g[8]=247;this.send(g)},
getPin:function(a){return this._ioPins[a]},getAnalogPin:function(a){return this._ioPins[this._analogPinMapping[a]]},getDigitalPin:function(a){return this._ioPins[this._digitalPinMapping[a]]},getPins:function(){return this._ioPins},analogToDigital:function(a){return this.getAnalogPin(a).number},getPinCount:function(){return this._totalPins},getAnalogPinCount:function(){return this._totalAnalogPins},getI2cPins:function(){return this._i2cPins},reportCapabilities:function(){for(var a=this.getPinCapabilities(),
b=a.length,c,d=0;d<b;d++){console.log("Pin "+d+":");for(var e in a[d])a[d].hasOwnProperty(e)&&(c=a[d][e],console.log("\t"+e+" ("+c+(1<c?" bits)":" bit)")))}},send:function(a){this._socket.sendString(a)},close:function(){this._socket.close()},addEventListener:function(a,b){this._evtDispatcher.addEventListener(a,b)},removeEventListener:function(a,b){this._evtDispatcher.removeEventListener(a,b)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,b){return this._evtDispatcher.dispatchEvent(a,
b)}};return a}();
