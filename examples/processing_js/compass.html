<!DOCTYPE html>
<html>
<head>

<meta charset=utf-8 />

<title>Breakout + processing.js Compass Example</title>

</head>
<body>
  
<canvas id='canvas1'></canvas>

<script src="../../dist/Breakout.js"></script>
<script src="libs/processing-1.3.6.min.js"></script>
<script type="text/javascript">

// declare these variables so you don't have to type the full namespace
var IOBoard = BO.IOBoard;
var IOBoardEvent = BO.IOBoardEvent;
var CompassEvent = BO.io.CompassEvent;
var CompassHMC6352 = BO.io.CompassHMC6352;

// get a reference to the Processing sketch object
var sketch = new Processing.Sketch();

console.log(sketch);

// if you want to use 3D, uncomment the following line
//sketch.use3DContext = true;

// preload images
sketch.imageCache.add("images/compass_img.png");

// get a reference to the canvas
var canvas = document.getElementById("canvas1");

// get a reference to the Processing object, passing a ref to 
// the canvas and sketch object
var pjs = new Processing(canvas, sketch);

console.log(pjs);

// attach the sketch function to the canvas 
// write the code for your sketch within this function
sketch.attachFunction = function(p) {
      
  var compass,
      heading,
      arduino,
      compassImg,
      isReady = false;
    
  // Override setup function
  p.setup = function() {
      p.size(200, 200);
      p.smooth();
      p.strokeWeight(2.0);
      p.ellipseMode(p.RADIUS);
      p.fill(230, 230, 230);

      compassImg = p.loadImage("images/compass_img.png");
      
      // create an instance of the IOBoard
      arduino = new IOBoard("192.168.2.3", 8887);
      arduino.addEventListener(IOBoardEvent.READY, onReady);
  };
  
  // Override draw function  
  p.draw = function() {
      
      // return if the IOBoard is not yet ready
      if (!isReady) return;
      
      p.background(255, 255, 255);

      p.image(compassImg, 0, 0);

      // translate to center of image to draw compass needle
      p.translate(p.width/2, p.height/2);
      
      // draw compass needle
      p.stroke(30, 204, 10);
      p.line(0, 0, 80*Math.cos(p.radians(heading)), 80*Math.sin(p.radians(heading)));
      
  };
  
  // setup the IOBoard once it is ready
  var onReady = function(event) {
      // remove the listener because it is no longer needed
      arduino.removeEventListener(IOBoardEvent.READY, onReady);
      
      // create a new instance of the compass module
      compass = new CompassHMC6352(arduino);
      // listen for a change of the heading
      compass.addEventListener(CompassEvent.UPDATE, onHeadingUpdate);

      // we are now ready to communicate with the IOBoard
      isReady = true;
  };
  
  var onHeadingUpdate = function(event) {
      heading = event.target.heading;
  };
    
};


</script>

</body>
</html>â€‹