'use strict';var BREAKOUT=BREAKOUT||{};BREAKOUT.namespace=function(a){var a=a.split("."),b=BREAKOUT,c;"BREAKOUT"===a[0]&&(a=a.slice(1));for(c=0;c<a.length;c+=1)"undefined"===typeof b[a[c]]&&(b[a[c]]={}),b=b[a[c]];return b};BREAKOUT.inherit=function(a){function b(){}if(null==a)throw TypeError();if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw TypeError();b.prototype=a;return new b};
if(!Function.prototype.bind)Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,e=function(){},d=function(){return c.apply(this instanceof e?this:a||window,b.concat(Array.prototype.slice.call(arguments)))};e.prototype=this.prototype;d.prototype=new e;return d};BREAKOUT.namespace("BREAKOUT.Event");BREAKOUT.Event=function(){var a;a=function(a){this.type=a;this.target=null;this.name="Event"};a.CONNECTED="connected";a.CHANGE="change";a.COMPLETE="complete";return a}();BREAKOUT.namespace("BREAKOUT.EventDispatcher");
BREAKOUT.EventDispatcher=function(){var a;a=function(a){this._target=a||null;this._eventListeners={};this.name="EventDispatcher"};a.prototype={addEventListener:function(a,c){this._eventListeners[a]||(this._eventListeners[a]=[]);this._eventListeners[a].push(c)},removeEventListener:function(a,c){for(var e=0,d=this._eventListeners[a].length;e<d;e++)this._eventListeners[a][e]==c&&this._eventListeners[a].splice(e,1)},hasEventListener:function(a){return this._eventListeners[a]?!0:!1},dispatchEvent:function(a,
c){a.target=this._target;var e=!1,d;for(d in c)a[d.toString()]=c[d];if(this.hasEventListener(a.type)){d=0;for(var f=this._eventListeners[a.type].length;d<f;d++)try{this._eventListeners[a.type][d].call(this,a),e=!0}catch(j){}}return e}};return a}();BREAKOUT.namespace("BREAKOUT.IOBoardEvent");
BREAKOUT.IOBoardEvent=function(){var a,b=BREAKOUT.Event;a=function(a){this.name="IOBoardEvent";b.call(this,a)};a.ANALOG_DATA="analodData";a.DIGITAL_DATA="digitalData";a.FIRMWARE_VERSION="firmwareVersion";a.FIRMWARE_NAME="firmwareName";a.STRING_MESSAGE="stringMessage";a.SYSEX_MESSAGE="sysexMessage";a.CAPABILITY_RESPONSE="capabilityResponse";a.PIN_STATE_RESPONSE="pinStateResponse";a.ANALOG_MAPPING_RESPONSE="analogMappingResponse";a.READY="arduinoReady";a.prototype=BREAKOUT.inherit(b.prototype);return a.prototype.constructor=
a}();BREAKOUT.namespace("BREAKOUT.WSocketEvent");BREAKOUT.WSocketEvent=function(){var a,b=BREAKOUT.Event;a=function(a){this.name="WSocketEvent";b.call(this,a)};a.CONNECTED="webSocketConnected";a.MESSAGE="webSocketMessage";a.CLOSE="webSocketClosed";a.prototype=BREAKOUT.inherit(b.prototype);return a.prototype.constructor=a}();BREAKOUT.namespace("BREAKOUT.WSocketWrapper");
BREAKOUT.WSocketWrapper=function(){var a,b=BREAKOUT.EventDispatcher,c=BREAKOUT.WSocketEvent;a=function(a,c,f,j){this.name="WSocketWrapper";b.call(this,this);this._host=a;this._port=c;this._protocol=j||"default-protocol";this._useSocketIO=f||!1;this._socket=null;this._readyState="";this.init(this)};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.init=function(a){if(a._useSocketIO){a._socket=io.connect("http://"+a._host+":"+a._port);try{a._socket.on("connect",function(){a.dispatchEvent(new c(c.CONNECTED));
a._socket.on("message",function(d){a.dispatchEvent(new c(c.MESSAGE),{message:d})})})}catch(d){console.log("Error "+d)}}else try{if("MozWebSocket"in window)a._socket=new MozWebSocket("ws://"+a._host+":"+a._port,a._protocol);else if("WebSocket"in window)a._socket=new WebSocket("ws://"+a._host+":"+a._port);else throw console.log("Websockets not supported by this browser"),"Websockets not supported by this browser";console.log("Starting up...");a._socket.onopen=function(){a.dispatchEvent(new c(c.CONNECTED));
a._socket.onmessage=function(d){a.dispatchEvent(new c(c.MESSAGE),{message:d.data})};a._socket.onclose=function(){a._readyState=a._socket.readyState;a.dispatchEvent(new c(c.CLOSE))}}}catch(f){console.log("Error "+f)}};a.prototype.send=function(a){this._socket.send(a)};a.prototype.__defineGetter__("readyState",function(){return this._readyState});return a}();BREAKOUT.namespace("BREAKOUT.Pin");
BREAKOUT.Pin=function(){var a,b=BREAKOUT.EventDispatcher,c=BREAKOUT.Event;a=function(a,c){this.name="Pin";this._type=c;this._number=a;this._analogNumber=void 0;this._lastValue=this._value=-1;this._average=0;this._minimum=Math.pow(2,16);this._numSamples=this._sum=this._avg=this._maximum=0;this._generator=this._generators=this._filters=null;this._evtDispatcher=new b(this)};a.prototype={setAnalogNumber:function(a){this._analogNumber=a},get analogNumber(){return this._analogNumber},get number(){return this._number},
get average(){return this._average},get minimum(){return this._minimum},get maximum(){return this._maximum},get value(){return this._value},set value(a){this.calculateMinMaxAndMean(a);this._lastValue=this._value;this._preFilterValue=a;this._value=this.applyFilters(a);this.detectChange(this._lastValue,this._value)},get lastValue(){return this._lastValue},get preFilterValue(){return this._preFilterValue},get filters(){return this._filters},set filters(a){if(null===a||0===a.length)this._filters=a},getType:function(){return this._type},
setType:function(c){if(0<=c&&c<a.TOTAL_PIN_MODES)this._type=c},getCapabilities:function(){return this._capabilities},setCapabilities:function(a){this._capabilities=a},detectChange:function(a,d){a!==d&&this.dispatchEvent(new c(c.CHANGE))},clearWeight:function(){this._sum=this._average;this._numSamples=1},calculateMinMaxAndMean:function(a){var c=Number.MAX_VALUE;this._minimum=Math.min(a,this._minimum);this._maximum=Math.max(a,this._maximum);this._sum+=a;this._average=this._sum/++this._numSamples;this._numSamples>=
c&&this.clearWeight()},clear:function(){this._minimum=this._maximum=this._average=this._lastValue=this._preFilterValue;this.clearWeight()},addFilter:function(a){if(null!==a){if(null===this._filters)this._filters=[];this._filters.push(a)}},setFilters:function(a){this.filters=a},removeAllFilters:function(){this._filters=null},autoSetValue:function(){this.value=_generator.value},applyFilters:function(a){if(null===this._filters)return a;for(var c=this._filters.length,f=0;f<c;f++)a=this._filters[f].processSample(a);
return a},addEventListener:function(a,c){this._evtDispatcher.addEventListener(a,c)},removeEventListener:function(a,c){this._evtDispatcher.removeEventListener(a,c)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,c){return this._evtDispatcher.dispatchEvent(a,c)}};a.HIGH=1;a.LOW=0;a.ON=1;a.OFF=0;a.DIN=0;a.DOUT=1;a.AIN=2;a.AOUT=3;a.PWM=3;a.SERVO=4;a.SHIFT=5;a.I2C=6;a.TOTAL_PIN_MODES=7;return a}();BREAKOUT.namespace("BREAKOUT.filters.FilterBase");BREAKOUT.filters.FilterBase=function(){var a;a=function(){throw Error("Can't instantiate abstract classes");};a.prototype.processSample=function(){throw Error("Filter objects must implement the method processSample");};return a}();BREAKOUT.namespace("BREAKOUT.filters.Scaler");
BREAKOUT.filters.Scaler=function(){var a,b=BREAKOUT.filters.FilterBase;a=function(a,e,d,f,b,h){this.name="Scaler";this._inMin=a||0;this._inMax=e||1;this._outMin=d||0;this._outMax=f||1;this._type=b||this.LINEAR;this._limiter=h||!0};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.processSample=function(a){var e=this._outMax-this._outMin,a=(a-this._inMin)/(this._inMax-this._inMin);this._limiter&&(a=Math.max(0,Math.min(1,a)));return e*this._type(a)+this._outMin};a.prototype.LINEAR=
function(a){return a};a.prototype.SQUARE=function(a){return a};a.prototype.SQUARE_ROOT=function(a){return a};a.prototype.CUBE=function(a){return a};a.prototype.CUBE_ROOT=function(a){return a};return a}();BREAKOUT.namespace("BREAKOUT.filters.Convolution");
BREAKOUT.filters.Convolution=function(){var a,b=BREAKOUT.filters.FilterBase;a=function(a){this.name="Convolution";this._buffer=[];this.coef=a};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("coef",function(){return this._coef});a.prototype.__defineSetter__("coef",function(a){this._coef=a;this._buffer=Array(this._coef.length);for(var a=this._buffer.length,e=0;e<a;e++)this._buffer[e]=0});a.prototype.processSample=function(a){this._buffer.unshift(a);
this._buffer.pop();for(var a=0,e=this._buffer.length,d=0;d<e;d++)a+=this._coef[d]*this._buffer[d];return a};a.LPF=[1/3,1/3,1/3];a.HPF=[1/3,-2/3,1/3];a.MOVING_AVERAGE=[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125];return a}();BREAKOUT.namespace("BREAKOUT.filters.TriggerPoint");
BREAKOUT.filters.TriggerPoint=function(){var a,b=BREAKOUT.filters.FilterBase;a=function(a){this.name="TriggerPoint";this._points={};this._range=[];void 0===a&&(a=[[0.5,0]]);if(a[0]instanceof Array)for(var e=a.length,d=0;d<e;d++)this._points[a[d][0]]=a[d][1];else"number"===typeof a[0]&&(this._points[a[0]]=a[1]);this.updateRange();this._lastStatus=0};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.processSample=function(a){for(var e=this._lastStatus,d=this._range.length,
f=0;f<d;++f){var b=this._range[f];if(b[0]<=a&&a<=b[1]){e=f;break}}return this._lastStatus=e};a.prototype.addPoint=function(a,e){this._points[a]=e;this.updateRange()};a.prototype.removePoint=function(a){delete this._points[a];this.updateRange()};a.prototype.removeAllPoints=function(){this._points=[];this.updateRange()};a.prototype.updateRange=function(){this._range=[];var a=this.getKeys(this._points),e=a[0];this._range.push([Number.NEGATIVE_INFINITY,e-this._points[e]]);for(var e=a.length-1,d=0;d<e;++d){var f=
a[d],b=a[d+1],f=f+this._points[f],b=b-this._points[b];if(f>=b)throw Error("The specified range overlaps...");this._range.push([f,b])}a=a[a.length-1];this._range.push([1*a+this._points[a],Number.POSITIVE_INFINITY])};a.prototype.getKeys=function(a){var e=[],d;for(d in a)e.push(d);return e.sort()};return a}();BREAKOUT.namespace("BREAKOUT.generators.GeneratorBase");BREAKOUT.generators.GeneratorBase=function(){var a,b=BREAKOUT.EventDispatcher;a=function(){b.call(this,this);this.name="GeneratorBase"};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("value",function(){return this._value});a.prototype.__defineSetter__("value",function(a){this._value=a});return a}();BREAKOUT.namespace("BREAKOUT.I2CBase");
BREAKOUT.I2CBase=function(){var a,b=BREAKOUT.Pin,c=BREAKOUT.EventDispatcher,e=BREAKOUT.IOBoardEvent;a=function(d,f,j){if(void 0!=d){this.name="I2CDevice";this.board=d;var h=j||0,j=h&255,h=h>>8&255;this._address=f;this._evtDispatcher=new c(this);f=d.getI2cPins();2==f.length?(d.getPin(f[0]).getType()!=b.I2C&&(d.getPin(f[0]).setType(b.I2C),d.getPin(f[1]).setType(b.I2C)),d.addEventListener(e.SYSEX_MESSAGE,this.onSysExMessage.bind(this)),d.sendSysex(a.I2C_CONFIG,[j,h])):console.log("Error, this board does not support i2c")}};
a.prototype={get address(){return this._address},onSysExMessage:function(d){var d=d.message,c=this.board.getValueFromTwo7bitBytes(d[1],d[2]),e=[];if(d[0]==a.I2C_REPLY&&c==this._address){for(var c=3,b=d.length;c<b;c+=2)e.push(this.board.getValueFromTwo7bitBytes(d[c],d[c+1]));this.handleI2C(e)}},sendI2CRequest:function(c){var e=[],b=c[0];e[0]=c[1];e[1]=b<<3;for(var b=2,h=c.length;b<h;b++)e.push(c[b]&127),e.push(c[b]>>7&127);this.board.sendSysex(a.I2C_REQUEST,e)},update:function(){},handleI2C:function(){},
addEventListener:function(a,c){this._evtDispatcher.addEventListener(a,c)},removeEventListener:function(a,c){this._evtDispatcher.removeEventListener(a,c)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,c){return this._evtDispatcher.dispatchEvent(a,c)}};a.I2C_REQUEST=118;a.I2C_REPLY=119;a.I2C_CONFIG=120;a.WRITE=0;a.READ=1;a.READ_CONTINUOUS=2;a.STOP_READING=3;return a}();BREAKOUT.namespace("BREAKOUT.io.BlinkM");
BREAKOUT.io.BlinkM=function(){var a,b=BREAKOUT.I2CBase;a=function(a,e){this.name="BlinkM";b.call(this,a,e||9)};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.goToRGBColorNow=function(a){this.sendI2CRequest([b.WRITE,this.address,110,a[0],a[1],a[2]])};a.prototype.fadeToRGBColor=function(a,e){e=e||-1;0<=e&&this.sendI2CRequest([b.WRITE,this.address,102,e]);this.sendI2CRequest([b.WRITE,this.address,99,a[0],a[1],a[2]])};a.prototype.fadeToRandomRGBColor=function(a,e){e=e||
-1;0<=e&&this.sendI2CRequest([b.WRITE,this.address,102,e]);this.sendI2CRequest([b.WRITE,this.address,67,a[0],a[1],a[2]])};a.prototype.fadeToHSBColor=function(a,e){e=e||-1;0<=e&&this.sendI2CRequest([b.WRITE,this.address,102,e]);this.sendI2CRequest([b.WRITE,this.address,104,a[0],a[1],a[2]])};a.prototype.fadeToRandomHSBColor=function(a,e){e=e||-1;0<=e&&this.sendI2CRequest([b.WRITE,this.address,102,e]);this.sendI2CRequest([b.WRITE,this.address,72,a[0],a[1],a[2]])};a.prototype.setFadeSpeed=function(a){this.sendI2CRequest([b.WRITE,
this.address,102,a])};a.prototype.playLightScript=function(a,e,d){this.sendI2CRequest([b.WRITE,this.address,112,a,e||1,d])};a.prototype.stopScript=function(){this.sendI2CRequest([b.WRITE,this.address,111])};a.prototype.handleI2C=function(a){console.log("BlinkM: "+a)};return a}();BREAKOUT.namespace("BREAKOUT.io.CompassHMC6352");
BREAKOUT.io.CompassHMC6352=function(){var a,b=BREAKOUT.I2CBase,c=BREAKOUT.Event;a=function(a,c){this._lastHeading=this._heading=0;this.name="CompassHMC6352";b.call(this,a,c||33);this.sendI2CRequest([b.WRITE,this.address,71,116,81]);this.sendI2CRequest([b.WRITE,this.address,65]);this.startReading()};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("heading",function(){return this._heading});a.prototype.handleI2C=function(a){this._heading=Math.floor((a[1]<<
8|a[2])/10);this._heading!=this._lastHeading&&this.dispatchEvent(new c(c.CHANGE));this._lastHeading=this._heading};a.prototype.startReading=function(){this.sendI2CRequest([b.READ_CONTINUOUS,this.address,127,2])};a.prototype.stopReading=function(){this.sendI2CRequest([b.STOP_READING,this.address])};return a}();BREAKOUT.namespace("BREAKOUT.PhysicalInputBase");
BREAKOUT.PhysicalInputBase=function(){var a,b=BREAKOUT.EventDispatcher;a=function(){this.name="PhysicalInputBase";this._evtDispatcher=new b(this)};a.prototype={addEventListener:function(a,b){this._evtDispatcher.addEventListener(a,b)},removeEventListener:function(a,b){this._evtDispatcher.removeEventListener(a,b)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},dispatchEvent:function(a,b){return this._evtDispatcher.dispatchEvent(a,b)}};return a}();BREAKOUT.namespace("BREAKOUT.io.ButtonEvent");BREAKOUT.io.ButtonEvent=function(){var a,b=BREAKOUT.Event;a=function(a){this.name="ButtonEvent";b.call(this,a)};a.PRESS="pressed";a.RELEASE="released";a.LONG_PRESS="longPress";a.SUSTAINED_PRESS="sustainedPress";a.prototype=BREAKOUT.inherit(b.prototype);return a.prototype.constructor=a}();BREAKOUT.namespace("BREAKOUT.io.Button");
BREAKOUT.io.Button=function(){var a,b=BREAKOUT.PhysicalInputBase,c=BREAKOUT.Event,e=BREAKOUT.Pin,d=BREAKOUT.io.ButtonEvent;a=function(d,j,h,t){b.call(this);this.name="Button";this._pin=j;j=j.number;this.buttonMode=h||a.PULL_DOWN;this._sustainedPressInterval=t||1E3;this._debounceInterval=20;this._repeatCount=0;this._timer=null;this._timeout=null;this._board=d;d.setDigitalPinMode(j,e.DIN);if(this.buttonMode===a.INTERNAL_PULL_UP)d.enablePullUp(j),this._pin.value=e.HIGH;this._pin.addEventListener(c.CHANGE,
this.onPinChange.bind(this))};a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.onPinChange=function(d){var d=d.target.value,b;if(this.buttonMode===a.PULL_DOWN)b=1===d?this.pressed:this.released;else if(this.buttonMode===a.PULL_UP||this.buttonMode===a.INTERNAL_PULL_UP)b=1===d?this.released:this.pressed;null!==this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(b.bind(this),this._debounceInterval)};a.prototype.pressed=function(){this._timeout=null;this.dispatchEvent(new d(d.PRESS));
this._timer=setInterval(this.sustainedPress.bind(this),this._sustainedPressInterval)};a.prototype.released=function(){this._timeout=null;this.dispatchEvent(new d(d.RELEASE));if(null!=this._timer)clearInterval(this._timer),this._timer=null;this._repeatCount=0};a.prototype.sustainedPress=function(){0<this._repeatCount?this.dispatchEvent(new d(d.SUSTAINED_PRESS)):this.dispatchEvent(new d(d.LONG_PRESS));this._repeatCount++};a.prototype.__defineGetter__("debounceInterval",function(){return this._debounceInterval});
a.prototype.__defineSetter__("debounceInterval",function(a){this._debounceInterval=a});a.prototype.__defineGetter__("sustainedPressInterval",function(){return this._sustainedPressInterval});a.prototype.__defineSetter__("sustainedPressInterval",function(a){this._sustainedPressInterval=a});a.prototype.__defineGetter__("pinNumber",function(){return this._pin.number});a.PULL_DOWN=0;a.PULL_UP=1;a.INTERNAL_PULL_UP=2;return a}();BREAKOUT.namespace("BREAKOUT.io.RFIDEvent");BREAKOUT.io.RFIDEvent=function(){var a,b=BREAKOUT.Event;a=function(a,e){this._tag=e;b.call(this,a)};a.ADD_TAG="addTag";a.REMOVE_TAG="removeTag";a.prototype=BREAKOUT.inherit(b.prototype);a.prototype.constructor=a;a.prototype.__defineGetter__("tag",function(){return this._tag});return a}();BREAKOUT.namespace("BREAKOUT.io.ID12RFIDReader");
BREAKOUT.io.ID12RFIDReader=function(){var a,b=BREAKOUT.EventDispatcher,c=BREAKOUT.IOBoardEvent,e=BREAKOUT.io.RFIDEvent;a=function(a){this.name="ID12RFIDReader";this.ID12_READER=13;this.READ_EVENT=1;this.REMOVE_EVENT=2;this.board=a;this._evtDispatcher=new b(this);a.addEventListener(c.SYSEX_MESSAGE,this.onSysExMessage.bind(this))};a.prototype={onSysExMessage:function(a){a=a.message;a[0]==this.ID12_READER&&this.processRFIDData(a)},dec2hex:function(a){return(a+256).toString(16).substr(-2).toUpperCase()},
processRFIDData:function(a){for(var b=this.board.getValueFromTwo7bitBytes(a[1],a[2]),c="",h=3,t=a.length;h<t;h+=2)c+=this.dec2hex(this.board.getValueFromTwo7bitBytes(a[h],a[h+1]));b==this.READ_EVENT?this.dispatch(new e(e.ADD_TAG,c)):b==this.REMOVE_EVENT&&this.dispatch(new e(e.REMOVE_TAG,c))},dispatch:function(a){this.dispatchEvent(a)},addEventListener:function(a,b){this._evtDispatcher.addEventListener(a,b)},removeEventListener:function(a,b){this._evtDispatcher.removeEventListener(a,b)},hasEventListener:function(a){return this._evtDispatcher.hasEventListener(a)},
dispatchEvent:function(a,b){return this._evtDispatcher.dispatchEvent(a,b)}};return a}();BREAKOUT.namespace("BREAKOUT.io.Servo");BREAKOUT.io.Servo=function(){var a,b=BREAKOUT.Pin;a=function(a,b){this.name="Servo";this._pin=b;a.sendServoAttach(b.number)};a.prototype={set angle(a){if(this._pin.getType()==b.SERVO)this._angle=a,this._pin.value=this._angle},get angle(){if(this._pin.getType()==b.SERVO)return this._angle}};return a}();BREAKOUT.namespace("BREAKOUT.IOBoard");
BREAKOUT.IOBoard=function(){var a=BREAKOUT.Pin,b=BREAKOUT.EventDispatcher,c=BREAKOUT.Event,e=BREAKOUT.WSocketEvent,d=BREAKOUT.WSocketWrapper,f=BREAKOUT.IOBoardEvent;return function(j,h,t,K){function D(a){g.removeEventListener(f.FIRMWARE_VERSION,D);23<=10*a.version?g.send([l,L,m]):console.log("You must upload StandardFirmata version 2.3 or greater from IOBoard version 1.0 or higher")}function M(){console.log("debug: startup");g.dispatchEvent(new f(f.READY));g.enableDigitalPins()}function E(a){a=a.substring(0,
1);return a.charCodeAt(0)}function F(i){var b=i.target.getType(),c=i.target.number,i=i.target.value;switch(b){case a.DOUT:G(c,i);break;case a.AOUT:if(15<c||i>Math.pow(2,14)){b=[];if(i>Math.pow(2,16))throw console.log("Extended Analog values > 16 bits are not currently supported by StandardFirmata"),"Extended Analog values > 16 bits are not currently supported by StandardFirmata";b[0]=l;b[1]=N;b[2]=c;b[3]=i&127;b[4]=i>>7&127;i>=Math.pow(2,14)&&(b[5]=i>>14&127);b.push(m);g.send(b)}else g.send([x|c&
15,i&127,i>>7&127]);break;case a.SERVO:b=g.getDigitalPin(c),b.getType()==a.SERVO&&b.lastValue!=i&&g.send([x|c&15,i%128,i>>7])}}function y(i){if(i.getType()==a.DOUT||i.getType()==a.AOUT||i.getType()==a.SERVO)i.hasEventListener(c.CHANGE)||i.addEventListener(c.CHANGE,F);else if(i.hasEventListener(c.CHANGE))try{i.removeEventListener(c.CHANGE,F)}catch(b){console.log("debug: caught pin removeEventListener exception")}}function G(i,b){var c=Math.floor(i/8);if(b==a.HIGH)s[c]|=b<<i%8;else if(b==a.LOW)s[c]&=
~(1<<i%8);else{console.log("invalid value passed to sendDigital, value must be 0 or 1");return}g.sendDigitalPort(c,s[c])}this.name="IOBoard";var x=224,l=240,m=247,N=111,L=107,g=this,n,A=0,B=0,r=[],o=[],p=0,s=[],u,C=[],H=[],I=[],q=[],v=0,J=19,w=0,z=new b(this);n=new d(j,h,t,K);n.addEventListener(e.CONNECTED,function(){console.log("Socket Status: (open)");g.dispatchEvent(new c(c.CONNECTED));g.addEventListener(f.FIRMWARE_VERSION,D);g.reportVersion()});n.addEventListener(e.MESSAGE,function(b){var b=b.message,
b=1*b,c;if(0<p&&128>b){if(p--,r[p]=b,0==p)switch(A){case 144:var e=8*B;c=e+8;var b=r[1]|r[0]<<7,d={};c>=v&&(c=v);for(var k=0,h=e;h<c;h++){d=g.getDigitalPin(h);if(void 0==d)break;if(d.getType()==a.DIN&&(e=b>>k&1,e!=d.value))d.value=e,g.dispatchEvent(new f(f.DIGITAL_DATA),{pin:d});k++}break;case 249:w=r[1]+r[0]/10;g.dispatchEvent(new f(f.FIRMWARE_VERSION),{version:w});break;case x:c=g.getAnalogPin(B);if(void 0==c)break;c.value=g.getValueFromTwo7bitBytes(r[1],r[0])/1023;c.value!=c.lastValue&&g.dispatchEvent(new f(f.ANALOG_DATA),
{pin:c})}}else if(0>p)if(b==m){p=0;switch(o[0]){case 121:c=o;b="";for(k=3;k<c.length;k+=2)d=String.fromCharCode(c[k]),d+=String.fromCharCode(c[k+1]),b+=d;w=c[1]+c[2]/10;g.dispatchEvent(new f(f.FIRMWARE_NAME),{name:b,version:w});break;case 113:c=o;b="";for(k=1;k<c.length;k+=2)d=String.fromCharCode(c[k]),d+=String.fromCharCode(c[k+1]),b+=d.charAt(0);g.dispatchEvent(new f(f.STRING_MESSAGE),{message:b});break;case 108:for(var b=o,d={},k=1,e=c=0,h=b.length,j;k<=h;)if(127==b[k]){H[c]=c;j=void 0;if(d[a.DOUT])j=
a.DOUT;if(d[a.AIN])j=a.AIN,C[e++]=c;j=new a(c,j);j.setCapabilities(d);y(j);q[c]=j;j.getCapabilities()[a.I2C]&&I.push(j.number);d={};c++;k++}else d[b[k]]=b[k+1],k+=2;u=Math.ceil(c/8);console.log("debug: num ports = "+u);for(b=0;b<u;b++)s[b]=0;v=c;console.log("debug: num pins = "+v);g.send([l,105,m]);break;case 110:b=o;d=b.length;k=b[1];e=b[2];h=q[k];4<d?c=g.getValueFromTwo7bitBytes(b[3],b[4]):3<d&&(c=b[3]);h.getType()!=e&&(h.setType(e),y(h));if(h.value!=c)h.value=c;g.dispatchEvent(new f(f.PIN_STATE_RESPONSE),
{pin:k,type:e,value:c});break;case 106:c=o;b=c.length;for(d=1;d<b;d++)127!=c[d]&&(C[c[d]]=d-1,g.getPin(d-1).setAnalogNumber(c[d]));console.log("debug: system reset");g.send(255);setTimeout(M,500);console.log("debug: configured");break;default:g.dispatchEvent(new f(f.SYSEX_MESSAGE),{message:o})}o=[]}else o.push(b);else switch(240>b?(c=b&240,B=b&15):c=b,c){case 249:case 144:case x:p=2;A=c;break;case l:p=-1,A=c}});n.addEventListener(e.CLOSE,function(){console.log("Socket Status: "+n.readyState+" (Closed)")});
this.__defineGetter__("samplingInterval",function(){return J});this.__defineSetter__("samplingInterval",function(a){10<=a&&100>=a?(J=a,g.send([l,122,a&127,a>>7&127,m])):console.log("sampling interval must be between 10 and 100")});this.getValueFromTwo7bitBytes=function(a,b){return b<<7|a};this.getSocket=function(){return n};this.reportVersion=function(){g.send(249)};this.reportFirmware=function(){g.send([l,121,m])};this.disableDigitalPins=function(){for(var b=0;b<u;b++)g.sendDigitalPortReporting(b,
a.OFF)};this.enableDigitalPins=function(){for(var b=0;b<u;b++)g.sendDigitalPortReporting(b,a.ON)};this.sendDigitalPortReporting=function(a,b){g.send([208|a,b])};this.enableAnalogPin=function(b){g.send([192|b,a.ON]);g.getAnalogPin(b).setType(a.AIN)};this.disableAnalogPin=function(b){g.send([192|b,a.OFF]);g.getAnalogPin(b).setType(a.AIN)};this.setDigitalPinMode=function(a,b){g.getDigitalPin(a).setType(b);y(g.getDigitalPin(a));g.send([244,a,b])};this.enablePullUp=function(b){G(b,a.HIGH)};this.getFirmwareVersion=
function(){return w};this.sendDigitalPort=function(a,b){g.send([144|a&15,b&127,b>>7])};this.sendString=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(E(a[c])&127),b.push(E(a[c])>>7&127);this.sendSysex(113,b)};this.sendSysex=function(a,b){var c=[];c[0]=l;c[1]=a;for(var d=0,e=b.length;d<e;d++)c.push(b[d]);c.push(m);g.send(c)};this.sendServoAttach=function(b,c,d){var c=c||544,d=d||2400,e=[];e[0]=l;e[1]=112;e[2]=b;e[3]=c%128;e[4]=c>>7;e[5]=d%128;e[6]=d>>7;e[7]=m;g.send(e);b=g.getDigitalPin(b);
b.setType(a.SERVO);y(b)};this.queryPinState=function(a){g.send([l,109,a.number,m])};this.getPin=function(a){return q[a]};this.getAnalogPin=function(a){return q[C[a]]};this.getDigitalPin=function(a){return q[H[a]]};this.getPinCount=function(){return v};this.getI2cPins=function(){return I};this.reportCapabilities=function(){for(var a={"0":"input",1:"output",2:"analog",3:"pwm",4:"servo",5:"shift",6:"i2c"},b=0,c=q.length;b<c;b++)for(var d in q[b].getCapabilities())console.log("pin "+b+"\tmode: "+a[d]+
"\tresolution (# of bits): "+q[b].getCapabilities()[d])};this.send=function(a){n.send(a)};this.close=function(){console.log("socket = "+n);n.close()};this.addEventListener=function(a,b){z.addEventListener(a,b)};this.removeEventListener=function(a,b){z.removeEventListener(a,b)};this.hasEventListener=function(a){return z.hasEventListener(a)};this.dispatchEvent=function(a,b){return z.dispatchEvent(a,b)}}}();
